{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/room-card.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { Droplets, ThermometerSun, Zap } from \"lucide-react\"\r\nimport type { Room } from \"@/lib/api\"\r\n\r\ninterface RoomCardProps {\r\n  room: Room\r\n  onClick: () => void\r\n}\r\n\r\nexport default function RoomCard({ room, onClick }: RoomCardProps) {\r\n  const isActive = room.inClass\r\n\r\n  const tempText =\r\n    room.currentTemperature != null ? `${room.currentTemperature.toFixed(1)}°C` : \"--\"\r\n\r\n  const luxText =\r\n    room.currentIlluminance != null ? `${room.currentIlluminance.toFixed(0)} lx` : \"--\"\r\n\r\n  const energyText =\r\n    room.currentEnergyKWh != null ? `${room.currentEnergyKWh.toFixed(2)} kWh` : \"--\"\r\n\r\n  return (\r\n    <button\r\n      onClick={onClick}\r\n      className=\"bg-white rounded-2xl p-5 w-full text-left hover:shadow-md transition-all border border-gray-100 hover:border-green-200\"\r\n    >\r\n      <div className=\"flex items-start justify-between mb-3\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <div\r\n            className={`w-2.5 h-2.5 rounded-full ${\r\n              isActive ? \"bg-green-500 shadow-sm shadow-green-500/50\" : \"bg-gray-300\"\r\n            }`}\r\n          />\r\n          <div>\r\n            <h3 className=\"font-bold text-gray-900 text-lg\">{room.name}</h3>\r\n            <p className=\"text-xs text-gray-500 mt-0.5\">\r\n              {room.building} • {room.description ?? \"\"}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {isActive ? (\r\n        <div className=\"px-3 py-2 bg-green-50 rounded-lg mb-4\">\r\n          <p className=\"text-xs font-medium text-green-700\">In class now</p>\r\n          <p className=\"text-xs text-green-600 mt-0.5 truncate\">\r\n            {room.courseName ?? \"Current class\"}{\" \"}\r\n            {room.lecturerName ? `• ${room.lecturerName}` : \"\"}\r\n          </p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"px-3 py-2 bg-gray-50 rounded-lg mb-4\">\r\n          <p className=\"text-xs font-medium text-gray-700\">No active class</p>\r\n          <p className=\"text-xs text-gray-600 mt-0.5\">\r\n            Next class at {room.nextClass ?? \"--\"}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-3 gap-3\">\r\n        <div className=\"text-center\">\r\n          <div className=\"flex justify-center mb-1\">\r\n            <ThermometerSun size={18} className=\"text-gray-400\" />\r\n          </div>\r\n          <p className=\"text-xs font-semibold text-gray-900\">{tempText}</p>\r\n          <p className=\"text-[11px] text-gray-500\">Temp</p>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"flex justify-center mb-1\">\r\n            <Droplets size={18} className=\"text-gray-400\" />\r\n          </div>\r\n          <p className=\"text-xs font-semibold text-gray-900\">{luxText}</p>\r\n          <p className=\"text-[11px] text-gray-500\">Lux</p>\r\n        </div>\r\n\r\n        <div className=\"text-center\">\r\n          <div className=\"flex justify-center mb-1\">\r\n            <Zap size={18} className=\"text-gray-400\" />\r\n          </div>\r\n          <p className=\"text-xs font-semibold text-gray-900\">{energyText}</p>\r\n          <p className=\"text-[11px] text-gray-500\">kWh</p>\r\n        </div>\r\n      </div>\r\n    </button>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAAA;AAFA;;;AAUe,SAAS,SAAS,EAAE,IAAI,EAAE,OAAO,EAAiB;IAC/D,MAAM,WAAW,KAAK,OAAO;IAE7B,MAAM,WACJ,KAAK,kBAAkB,IAAI,OAAO,GAAG,KAAK,kBAAkB,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,GAAG;IAEhF,MAAM,UACJ,KAAK,kBAAkB,IAAI,OAAO,GAAG,KAAK,kBAAkB,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC,GAAG;IAEjF,MAAM,aACJ,KAAK,gBAAgB,IAAI,OAAO,GAAG,KAAK,gBAAgB,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG;IAE9E,qBACE,8OAAC;QACC,SAAS;QACT,WAAU;;0BAEV,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,WAAW,CAAC,yBAAyB,EACnC,WAAW,+CAA+C,eAC1D;;;;;;sCAEJ,8OAAC;;8CACC,8OAAC;oCAAG,WAAU;8CAAmC,KAAK,IAAI;;;;;;8CAC1D,8OAAC;oCAAE,WAAU;;wCACV,KAAK,QAAQ;wCAAC;wCAAI,KAAK,WAAW,IAAI;;;;;;;;;;;;;;;;;;;;;;;;YAM9C,yBACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;kCAAqC;;;;;;kCAClD,8OAAC;wBAAE,WAAU;;4BACV,KAAK,UAAU,IAAI;4BAAiB;4BACpC,KAAK,YAAY,GAAG,CAAC,EAAE,EAAE,KAAK,YAAY,EAAE,GAAG;;;;;;;;;;;;qCAIpD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAE,WAAU;kCAAoC;;;;;;kCACjD,8OAAC;wBAAE,WAAU;;4BAA+B;4BAC3B,KAAK,SAAS,IAAI;;;;;;;;;;;;;0BAKvC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,4OAAc;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;0CAEtC,8OAAC;gCAAE,WAAU;0CAAuC;;;;;;0CACpD,8OAAC;gCAAE,WAAU;0CAA4B;;;;;;;;;;;;kCAG3C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,sNAAQ;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;0CAEhC,8OAAC;gCAAE,WAAU;0CAAuC;;;;;;0CACpD,8OAAC;gCAAE,WAAU;0CAA4B;;;;;;;;;;;;kCAG3C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,uMAAG;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;0CAE3B,8OAAC;gCAAE,WAAU;0CAAuC;;;;;;0CACpD,8OAAC;gCAAE,WAAU;0CAA4B;;;;;;;;;;;;;;;;;;;;;;;;AAKnD"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/detail-tabs/metrics-tab.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { ThermometerSun, Sun } from \"lucide-react\"\r\nimport type { Room } from \"@/lib/api\"\r\n\r\ninterface MetricsTabProps {\r\n  room: Room\r\n}\r\n\r\nexport default function MetricsTab({ room }: MetricsTabProps) {\r\n  const currentTemp = room.currentTemperature ?? null\r\n  const targetTemp = room.targetTemperature ?? null\r\n\r\n  const currentLux = room.currentIlluminance ?? null\r\n  const targetLux = room.targetLux ?? null\r\n\r\n  const tempDiff =\r\n    currentTemp != null && targetTemp != null ? currentTemp - targetTemp : null\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Temperature card */}\r\n      <div className=\"bg-white rounded-2xl p-6 border border-gray-100 shadow-sm\">\r\n        <div className=\"flex items-center gap-3 mb-5\">\r\n          <div className=\"w-10 h-10 rounded-xl bg-orange-50 flex items-center justify-center\">\r\n            <ThermometerSun size={20} className=\"text-orange-600\" />\r\n          </div>\r\n          <h3 className=\"font-semibold text-gray-900\">Temperature</h3>\r\n        </div>\r\n\r\n        <div className=\"flex items-end justify-between mb-4\">\r\n          <div>\r\n            <p className=\"text-sm text-gray-600 mb-1\">Current</p>\r\n            <p className=\"text-4xl font-bold text-gray-900\">\r\n              {currentTemp != null ? currentTemp.toFixed(1) : \"--\"}\r\n              <span className=\"text-2xl\">°C</span>\r\n            </p>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <p className=\"text-sm text-gray-600 mb-1\">Target</p>\r\n            <p className=\"text-3xl font-bold text-green-600\">\r\n              {targetTemp != null ? targetTemp.toFixed(1) : \"--\"}\r\n              <span className=\"text-xl\">°C</span>\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <p className=\"text-sm text-gray-600\">\r\n          {tempDiff == null\r\n            ? \"No comparison available\"\r\n            : tempDiff > 0\r\n            ? `${tempDiff.toFixed(1)}°C above target`\r\n            : tempDiff < 0\r\n            ? `${Math.abs(tempDiff).toFixed(1)}°C below target`\r\n            : \"At target temperature\"}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Illuminance card */}\r\n      <div className=\"bg-white rounded-2xl p-6 border border-gray-100 shadow-sm\">\r\n        <div className=\"flex items-center gap-3 mb-5\">\r\n          <div className=\"w-10 h-10 rounded-xl bg-yellow-50 flex items-center justify-center\">\r\n            <Sun size={20} className=\"text-yellow-600\" />\r\n          </div>\r\n          <h3 className=\"font-semibold text-gray-900\">Illuminance</h3>\r\n        </div>\r\n\r\n        <div className=\"flex items-end justify-between mb-4\">\r\n          <div>\r\n            <p className=\"text-sm text-gray-600 mb-1\">Current</p>\r\n            <p className=\"text-3xl font-bold text-gray-900\">\r\n              {currentLux != null ? currentLux.toFixed(0) : \"--\"}\r\n              <span className=\"text-lg\"> lux</span>\r\n            </p>\r\n          </div>\r\n          <div className=\"text-right\">\r\n            <p className=\"text-sm text-gray-600 mb-1\">Target</p>\r\n            <p className=\"text-2xl font-bold text-green-600\">\r\n              {targetLux != null ? targetLux.toFixed(0) : \"--\"}\r\n              <span className=\"text-lg\"> lux</span>\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {currentLux != null && targetLux != null && (\r\n          <div\r\n            className={`inline-block px-3 py-1.5 rounded-lg text-xs font-medium ${\r\n              currentLux >= targetLux\r\n                ? \"bg-green-50 text-green-700\"\r\n                : \"bg-amber-50 text-amber-700\"\r\n            }`}\r\n          >\r\n            {currentLux >= targetLux ? \"Comfortable\" : \"Below target\"}\r\n          </div>\r\n        )}\r\n\r\n        {(currentLux == null || targetLux == null) && (\r\n          <p className=\"text-xs text-gray-400\">No lux target configured</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAFA;;;AASe,SAAS,WAAW,EAAE,IAAI,EAAmB;IAC1D,MAAM,cAAc,KAAK,kBAAkB,IAAI;IAC/C,MAAM,aAAa,KAAK,iBAAiB,IAAI;IAE7C,MAAM,aAAa,KAAK,kBAAkB,IAAI;IAC9C,MAAM,YAAY,KAAK,SAAS,IAAI;IAEpC,MAAM,WACJ,eAAe,QAAQ,cAAc,OAAO,cAAc,aAAa;IAEzE,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,4OAAc;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;0CAEtC,8OAAC;gCAAG,WAAU;0CAA8B;;;;;;;;;;;;kCAG9C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;;kDACC,8OAAC;wCAAE,WAAU;kDAA6B;;;;;;kDAC1C,8OAAC;wCAAE,WAAU;;4CACV,eAAe,OAAO,YAAY,OAAO,CAAC,KAAK;0DAChD,8OAAC;gDAAK,WAAU;0DAAW;;;;;;;;;;;;;;;;;;0CAG/B,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDAA6B;;;;;;kDAC1C,8OAAC;wCAAE,WAAU;;4CACV,cAAc,OAAO,WAAW,OAAO,CAAC,KAAK;0DAC9C,8OAAC;gDAAK,WAAU;0DAAU;;;;;;;;;;;;;;;;;;;;;;;;kCAKhC,8OAAC;wBAAE,WAAU;kCACV,YAAY,OACT,4BACA,WAAW,IACX,GAAG,SAAS,OAAO,CAAC,GAAG,eAAe,CAAC,GACvC,WAAW,IACX,GAAG,KAAK,GAAG,CAAC,UAAU,OAAO,CAAC,GAAG,eAAe,CAAC,GACjD;;;;;;;;;;;;0BAKR,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,uMAAG;oCAAC,MAAM;oCAAI,WAAU;;;;;;;;;;;0CAE3B,8OAAC;gCAAG,WAAU;0CAA8B;;;;;;;;;;;;kCAG9C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;;kDACC,8OAAC;wCAAE,WAAU;kDAA6B;;;;;;kDAC1C,8OAAC;wCAAE,WAAU;;4CACV,cAAc,OAAO,WAAW,OAAO,CAAC,KAAK;0DAC9C,8OAAC;gDAAK,WAAU;0DAAU;;;;;;;;;;;;;;;;;;0CAG9B,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAE,WAAU;kDAA6B;;;;;;kDAC1C,8OAAC;wCAAE,WAAU;;4CACV,aAAa,OAAO,UAAU,OAAO,CAAC,KAAK;0DAC5C,8OAAC;gDAAK,WAAU;0DAAU;;;;;;;;;;;;;;;;;;;;;;;;oBAK/B,cAAc,QAAQ,aAAa,sBAClC,8OAAC;wBACC,WAAW,CAAC,wDAAwD,EAClE,cAAc,YACV,+BACA,8BACJ;kCAED,cAAc,YAAY,gBAAgB;;;;;;oBAI9C,CAAC,cAAc,QAAQ,aAAa,IAAI,mBACvC,8OAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;;;;;;;;AAK/C"}},
    {"offset": {"line": 563, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/lib/api.ts"],"sourcesContent":["// lib/api.ts\r\n\r\n// ---------- Types ----------\r\n\r\nexport type Room = {\r\n  id: string;\r\n  name: string;\r\n  building: string;\r\n  floor: string;\r\n  inClass: boolean;\r\n\r\n  description?: string;\r\n  courseName?: string;\r\n  lecturerName?: string;\r\n  nextClass?: string;\r\n\r\n  currentTemperature?: number;\r\n  targetTemperature?: number;\r\n  currentIlluminance?: number;\r\n  targetLux?: number;\r\n  currentEnergyKWh?: number;\r\n};\r\n\r\nexport type Schedule = {\r\n  id: string;\r\n  roomId: string;\r\n  roomName: string;\r\n  courseName: string;\r\n  lecturer: string;\r\n  weekdays: string[];\r\n  startTime: string;\r\n  endTime: string;\r\n  // NEW: Thêm 2 trường hiệu lực\r\n  effectiveFrom?: string; // Format YYYY-MM-DD\r\n  effectiveTo?: string;   // Format YYYY-MM-DD\r\n  enabled?: boolean;\r\n};\r\n\r\nexport type Device = {\r\n  id: string;\r\n  name: string;\r\n  type: string;      // \"ac\" | \"light\" | \"sensor\" | \"energy\" | ...\r\n  roomId: string;\r\n  roomName: string;\r\n  status: string;    // \"online\" | \"offline\" | ...\r\n};\r\n\r\nexport type LightState = {\r\n  roomId: string;\r\n  deviceId: string;\r\n  powerState: boolean;\r\n  brightness: number;\r\n\r\n  overrideActive: boolean;\r\n  overrideExpiresOnUtc?: string | null;\r\n  overrideExpiresOnLocal?: string | null;\r\n  overrideExpiresOnLocalFormatted?: string | null;\r\n\r\n  controlMode?: \"manual-override\" | \"auto-schedule\";\r\n};\r\n\r\nexport type AcState = {\r\n  roomId: string;\r\n  deviceId: string;\r\n\r\n  powerState: boolean;\r\n  mode?: string | null;\r\n  fanSpeed?: string | null;\r\n  targetTemperature?: number | null;\r\n  currentTemperature?: number | null;\r\n\r\n  overrideActive: boolean;\r\n  overrideExpiresOnUtc?: string | null;\r\n  overrideExpiresOnLocal?: string | null;\r\n  overrideExpiresOnLocalFormatted?: string | null;\r\n\r\n  lastUpdatedBy?: string | null;\r\n  controlMode?: \"manual-override\" | \"auto-schedule\";\r\n};\r\n\r\n\r\n// ---------- Constants (API base & keys) ----------\r\n\r\nconst BASE_URL =\r\n  \"https://greentwiniotcentraltrigger-ezgmgugyb9fkfwem.japaneast-01.azurewebsites.net/api\";\r\n\r\n// --- ROOM KEYS ---\r\nconst ROOMS_KEY =\r\n  \"XcGh9Rjnkz-NiNrgK6_qD4_slZugmc38Qob2svJAcFEJAzFuoBUalg==\";\r\n\r\nconst DEVICES_KEY =\r\n  \"uKQLG3SulECzSU_jJPLsNBoVPG889Qy5IaaxNmiJ5G9QAzFuPH_SrQ==\";\r\n\r\n// --- SCHEDULE KEYS (TODO: Hãy điền key thật từ Azure Portal vào đây) ---\r\nconst SCHEDULES_KEY = \"eSCCmJ4DKYgcmQ0YPab8aDMJ5pWuSJQLO7-n3PnV2i5AAzFuSIAbLg==\"; \r\nconst CREATE_SCHED_KEY = \"OnmL436GYbEjy9MQ9CCxvK3Bhb0vRmC7_aDn8vYHuvBBAzFuK1NCMw==\"; \r\nconst DEL_SCHED_KEY = \"Z7O9oOwF5F0YLXg46BvQ_SsVZyjPyVMZqIirU8gsFZhGAzFu0IKyig==\"; \r\n\r\n// --- CONTROL KEYS ---\r\nconst AC_CONTROL_KEY =\r\n  \"bQAT_PQdIK8_JdHjU6tb1XvNt6-NQ77MnXYtMztVqdCYAzFuGFUySQ==\"; \r\n\r\nconst AC_STATE_KEY = \"8d-Vxdj_SdNoek78nrbj3k8s1UWfbKXwt27XjEZxyp7PAzFucjwhVg==\";\r\n\r\nconst LIGHT_CONTROL_KEY =\r\n  \"s8nazlhbZ6i5h2WAj2FzPkj0p-H1NtkkrZLHT_h6RAKzAzFunXpung==\";\r\n\r\nconst LIGHT_STATE_KEY =\r\n  \"Mk8ouqhlOoqhCxYnIgxF3aVleuQ2TBujU-f-bpG_p1GDAzFuZq9lFA==\";\r\n\r\n// ---------- API calls ----------\r\n\r\n// 1. Lấy danh sách phòng\r\nexport async function getRooms(): Promise<Room[]> {\r\n  const res = await fetch(`${BASE_URL}/rooms?code=${ROOMS_KEY}`, {\r\n    cache: \"no-store\",\r\n  });\r\n\r\n  if (!res.ok) {\r\n    console.error(\"Failed to load rooms\", res.status, await res.text());\r\n    throw new Error(\"Failed to load rooms\");\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\n// 2. Lấy danh sách lịch học (API Thật)\r\nexport async function getSchedules(): Promise<Schedule[]> {\r\n  // Gọi endpoint GetSchedules\r\n  const res = await fetch(`${BASE_URL}/schedules?code=${SCHEDULES_KEY}`, { \r\n    cache: \"no-store\" \r\n  });\r\n\r\n  if (!res.ok) {\r\n    console.error(\"Failed load schedules\", res.status);\r\n    return []; // Trả về rỗng nếu lỗi để không crash UI\r\n  }\r\n  return res.json();\r\n}\r\n\r\n// 3. Tạo lịch học mới (API Thật) - Đã cập nhật Payload\r\nexport async function createSchedule(\r\n  roomId: string, \r\n  data: { \r\n    courseName: string; \r\n    lecturer: string; \r\n    weekdays: string[]; \r\n    startTime: string; \r\n    endTime: string; \r\n    // NEW: Thêm 2 trường này vào payload gửi đi\r\n    effectiveFrom: string;\r\n    effectiveTo: string;\r\n  }\r\n): Promise<Schedule> {\r\n  const res = await fetch(\r\n    `${BASE_URL}/rooms/${roomId}/schedules?code=${CREATE_SCHED_KEY}`,\r\n    {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(data),\r\n    }\r\n  );\r\n\r\n  if (!res.ok) {\r\n    const text = await res.text();\r\n    throw new Error(text || \"Failed to create schedule\");\r\n  }\r\n  return res.json();\r\n}\r\n\r\n// 4. Xóa lịch học (API Thật)\r\nexport async function deleteSchedule(scheduleId: string): Promise<void> {\r\n  // Encode ID để tránh lỗi URL nếu ID có ký tự đặc biệt\r\n  const encodedId = encodeURIComponent(scheduleId);\r\n  \r\n  const res = await fetch(\r\n    `${BASE_URL}/schedules/${encodedId}?code=${DEL_SCHED_KEY}`,\r\n    { method: \"DELETE\" }\r\n  );\r\n\r\n  if (!res.ok) {\r\n    // Đọc text lỗi từ server để debug\r\n    const errorText = await res.text();\r\n    console.error(`Delete failed (Status: ${res.status}):`, errorText);\r\n    throw new Error(`Failed to delete schedule: ${res.status} ${errorText}`);\r\n  }\r\n}\r\n\r\n// 5. Lấy danh sách thiết bị trong 1 room\r\nexport async function getDevicesForRoom(roomId: string): Promise<Device[]> {\r\n  const res = await fetch(\r\n    `${BASE_URL}/rooms/${encodeURIComponent(roomId)}/devices?code=${DEVICES_KEY}`,\r\n    { cache: \"no-store\" }\r\n  );\r\n\r\n  if (!res.ok) {\r\n    console.error(\"Failed to load devices\", res.status, await res.text());\r\n    throw new Error(\"Failed to load devices\");\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\n// --- AC Control ---\r\n\r\nexport async function getAcState(\r\n  roomId: string,\r\n  deviceId: string\r\n): Promise<AcState> {\r\n  const res = await fetch(\r\n    `${BASE_URL}/rooms/${encodeURIComponent(\r\n      roomId\r\n    )}/devices/${encodeURIComponent(\r\n      deviceId\r\n    )}/ac-state?code=${AC_STATE_KEY}`,\r\n    { cache: \"no-store\" }\r\n  );\r\n\r\n  if (!res.ok) {\r\n    const text = await res.text();\r\n    console.error(\"Failed to load AC state\", {\r\n      status: res.status,\r\n      body: text,\r\n    });\r\n    throw new Error(text || \"Failed to load AC state\");\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\nexport type UpdateAcPayload = {\r\n  powerState?: boolean;\r\n  mode?: string;\r\n  fanSpeed?: string;\r\n  targetTemperature?: number;\r\n  user?: string;\r\n  durationMinutes?: number;\r\n};\r\n\r\nexport async function updateAcSettings(\r\n  roomId: string,\r\n  deviceId: string,\r\n  payload: UpdateAcPayload\r\n): Promise<AcState> {\r\n  const res = await fetch(\r\n    `${BASE_URL}/rooms/${encodeURIComponent(\r\n      roomId\r\n    )}/devices/${encodeURIComponent(\r\n      deviceId\r\n    )}/ac-control?code=${AC_CONTROL_KEY}`,\r\n    {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(payload),\r\n    }\r\n  );\r\n\r\n  if (!res.ok) {\r\n    const text = await res.text();\r\n    console.error(\"Failed to update AC detail\", {\r\n      status: res.status,\r\n      body: text,\r\n    });\r\n    throw new Error(text || \"Failed to update AC\");\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\n\r\n// --- Light control ---\r\n\r\nexport async function getLightState(\r\n  roomId: string,\r\n  deviceId: string\r\n): Promise<LightState> {\r\n  const res = await fetch(\r\n    `${BASE_URL}/rooms/${encodeURIComponent(\r\n      roomId\r\n    )}/devices/${encodeURIComponent(\r\n      deviceId\r\n    )}/light-state?code=${LIGHT_STATE_KEY}`,\r\n    { cache: \"no-store\" }\r\n  );\r\n\r\n  if (!res.ok) {\r\n    console.error(\"Failed to load light state\", res.status, await res.text());\r\n    throw new Error(\"Failed to load light state\");\r\n  }\r\n\r\n  return res.json();\r\n}\r\n\r\nexport type UpdateLightPayload = {\r\n  powerState?: boolean;\r\n  brightness?: number;\r\n  durationMinutes?: number;\r\n};\r\n\r\nexport async function updateLightSettings(\r\n  roomId: string,\r\n  deviceId: string,\r\n  payload: UpdateLightPayload\r\n): Promise<LightState> {\r\n  const res = await fetch(\r\n    `${BASE_URL}/rooms/${encodeURIComponent(\r\n      roomId\r\n    )}/devices/${encodeURIComponent(\r\n      deviceId\r\n    )}/light-control?code=${LIGHT_CONTROL_KEY}`,\r\n    {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(payload),\r\n    }\r\n  );\r\n\r\n    if (!res.ok) {\r\n    const text = await res.text();\r\n    console.error(\"Failed to update Light detail\", {\r\n      url: res.url,\r\n      status: res.status,\r\n      statusText: res.statusText,\r\n      body: text,\r\n    });\r\n    throw new Error(text || `Failed to update Light (${res.status})`);\r\n  }\r\n\r\n  return res.json();\r\n}"],"names":[],"mappings":"AAAA,aAAa;AAEb,8BAA8B;;;;;;;;;;;;;;;;;;;;;AA+E9B,oDAAoD;AAEpD,MAAM,WACJ;AAEF,oBAAoB;AACpB,MAAM,YACJ;AAEF,MAAM,cACJ;AAEF,0EAA0E;AAC1E,MAAM,gBAAgB;AACtB,MAAM,mBAAmB;AACzB,MAAM,gBAAgB;AAEtB,uBAAuB;AACvB,MAAM,iBACJ;AAEF,MAAM,eAAe;AAErB,MAAM,oBACJ;AAEF,MAAM,kBACJ;AAKK,eAAe;IACpB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,YAAY,EAAE,WAAW,EAAE;QAC7D,OAAO;IACT;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,QAAQ,KAAK,CAAC,wBAAwB,IAAI,MAAM,EAAE,MAAM,IAAI,IAAI;QAChE,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,IAAI;AACjB;AAGO,eAAe;IACpB,4BAA4B;IAC5B,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,gBAAgB,EAAE,eAAe,EAAE;QACrE,OAAO;IACT;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,QAAQ,KAAK,CAAC,yBAAyB,IAAI,MAAM;QACjD,OAAO,EAAE,EAAE,wCAAwC;IACrD;IACA,OAAO,IAAI,IAAI;AACjB;AAGO,eAAe,eACpB,MAAc,EACd,IASC;IAED,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,OAAO,EAAE,OAAO,gBAAgB,EAAE,kBAAkB,EAChE;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAGF,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,IAAI,MAAM,QAAQ;IAC1B;IACA,OAAO,IAAI,IAAI;AACjB;AAGO,eAAe,eAAe,UAAkB;IACrD,sDAAsD;IACtD,MAAM,YAAY,mBAAmB;IAErC,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,WAAW,EAAE,UAAU,MAAM,EAAE,eAAe,EAC1D;QAAE,QAAQ;IAAS;IAGrB,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,kCAAkC;QAClC,MAAM,YAAY,MAAM,IAAI,IAAI;QAChC,QAAQ,KAAK,CAAC,CAAC,uBAAuB,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,EAAE;QACxD,MAAM,IAAI,MAAM,CAAC,2BAA2B,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,WAAW;IACzE;AACF;AAGO,eAAe,kBAAkB,MAAc;IACpD,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,OAAO,EAAE,mBAAmB,QAAQ,cAAc,EAAE,aAAa,EAC7E;QAAE,OAAO;IAAW;IAGtB,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,QAAQ,KAAK,CAAC,0BAA0B,IAAI,MAAM,EAAE,MAAM,IAAI,IAAI;QAClE,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,IAAI;AACjB;AAIO,eAAe,WACpB,MAAc,EACd,QAAgB;IAEhB,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,OAAO,EAAE,mBACnB,QACA,SAAS,EAAE,mBACX,UACA,eAAe,EAAE,cAAc,EACjC;QAAE,OAAO;IAAW;IAGtB,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,KAAK,CAAC,2BAA2B;YACvC,QAAQ,IAAI,MAAM;YAClB,MAAM;QACR;QACA,MAAM,IAAI,MAAM,QAAQ;IAC1B;IAEA,OAAO,IAAI,IAAI;AACjB;AAWO,eAAe,iBACpB,MAAc,EACd,QAAgB,EAChB,OAAwB;IAExB,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,OAAO,EAAE,mBACnB,QACA,SAAS,EAAE,mBACX,UACA,iBAAiB,EAAE,gBAAgB,EACrC;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAGF,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,KAAK,CAAC,8BAA8B;YAC1C,QAAQ,IAAI,MAAM;YAClB,MAAM;QACR;QACA,MAAM,IAAI,MAAM,QAAQ;IAC1B;IAEA,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,cACpB,MAAc,EACd,QAAgB;IAEhB,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,OAAO,EAAE,mBACnB,QACA,SAAS,EAAE,mBACX,UACA,kBAAkB,EAAE,iBAAiB,EACvC;QAAE,OAAO;IAAW;IAGtB,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,QAAQ,KAAK,CAAC,8BAA8B,IAAI,MAAM,EAAE,MAAM,IAAI,IAAI;QACtE,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,IAAI,IAAI;AACjB;AAQO,eAAe,oBACpB,MAAc,EACd,QAAgB,EAChB,OAA2B;IAE3B,MAAM,MAAM,MAAM,MAChB,GAAG,SAAS,OAAO,EAAE,mBACnB,QACA,SAAS,EAAE,mBACX,UACA,oBAAoB,EAAE,mBAAmB,EAC3C;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAGA,IAAI,CAAC,IAAI,EAAE,EAAE;QACb,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,KAAK,CAAC,iCAAiC;YAC7C,KAAK,IAAI,GAAG;YACZ,QAAQ,IAAI,MAAM;YAClB,YAAY,IAAI,UAAU;YAC1B,MAAM;QACR;QACA,MAAM,IAAI,MAAM,QAAQ,CAAC,wBAAwB,EAAE,IAAI,MAAM,CAAC,CAAC,CAAC;IAClE;IAEA,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 723, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/lib/user.ts"],"sourcesContent":["export const CURRENT_USER = \"Bang\";\r\n"],"names":[],"mappings":";;;;AAAO,MAAM,eAAe"}},
    {"offset": {"line": 732, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/device-details/ac-detail-modal.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useRef } from \"react\"\r\nimport { X, Wind, Minus, Plus, Clock, User, Zap, Power } from \"lucide-react\"\r\nimport { getAcState, updateAcSettings, type AcState } from \"@/lib/api\"\r\nimport { CURRENT_USER } from \"@/lib/user\"\r\n\r\ninterface ACDetailModalProps {\r\n  device: any;\r\n  roomId: string;\r\n  onClose: () => void;\r\n}\r\n\r\nexport default function ACDetailModal({ device, roomId, onClose }: ACDetailModalProps) {\r\n  const deviceId = device.id;\r\n\r\n  // Data State\r\n  const [acState, setAcState] = useState<AcState | null>(null);\r\n  \r\n  // UI Local States (Optimistic UI)\r\n  const [localPower, setLocalPower] = useState<boolean>(device.powerState ?? true);\r\n  const [localMode, setLocalMode] = useState<string>(device.mode ?? \"cool\");\r\n  const [localFan, setLocalFan] = useState<string>(device.fanSpeed ?? \"auto\");\r\n  const [localTemp, setLocalTemp] = useState<number>(device.targetTemperature ?? 24);\r\n\r\n  // Override Duration State (Default 60 mins)\r\n  const [overrideDuration, setOverrideDuration] = useState<number>(60);\r\n\r\n  const [saving, setSaving] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  const isSavingRef = useRef(false);\r\n\r\n  // Helper: Format End Time (e.g. 14:30)\r\n  const getEndTimeString = (minutes: number) => {\r\n    const end = new Date();\r\n    end.setMinutes(end.getMinutes() + minutes);\r\n    return end.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });\r\n  };\r\n\r\n  // Helper: Format Duration (e.g. 1h 30m)\r\n  const formatDuration = (mins: number) => {\r\n    const h = Math.floor(mins / 60);\r\n    const m = mins % 60;\r\n    if (h === 0) return `${m}m`;\r\n    if (m === 0) return `${h}h`;\r\n    return `${h}h ${m}m`;\r\n  };\r\n\r\n  const fetchData = async (isInitialLoad = false) => {\r\n    if (isSavingRef.current && !isInitialLoad) return;\r\n    if (!roomId || !deviceId) return;\r\n\r\n    try {\r\n      const state = await getAcState(roomId, deviceId);\r\n      setAcState(state);\r\n      \r\n      if (!isSavingRef.current || isInitialLoad) {\r\n        if (state.powerState !== undefined) setLocalPower(state.powerState);\r\n        if (state.mode) setLocalMode(state.mode);\r\n        if (state.fanSpeed) setLocalFan(state.fanSpeed);\r\n        if (typeof state.targetTemperature === 'number') {\r\n          setLocalTemp(state.targetTemperature);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Poll error:\", e);\r\n    } finally {\r\n        setLoading(false); \r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    isSavingRef.current = false;\r\n    fetchData(true);\r\n    const interval = setInterval(() => fetchData(false), 5000);\r\n    return () => clearInterval(interval);\r\n  }, [roomId, deviceId]);\r\n\r\n  const handleUpdate = (updates: any) => {\r\n    if (updates.powerState !== undefined) setLocalPower(updates.powerState);\r\n    if (updates.mode) setLocalMode(updates.mode);\r\n    if (updates.fanSpeed) setLocalFan(updates.fanSpeed);\r\n    if (updates.targetTemperature) setLocalTemp(updates.targetTemperature);\r\n  };\r\n\r\n  async function onApplyChanges() {\r\n    try {\r\n      setSaving(true);\r\n      isSavingRef.current = true;\r\n\r\n      const updatedState = await updateAcSettings(roomId, deviceId, {\r\n        powerState: localPower,\r\n        mode: localMode,\r\n        fanSpeed: localFan,\r\n        targetTemperature: localTemp,\r\n        user: CURRENT_USER,\r\n        durationMinutes: overrideDuration,\r\n      });\r\n\r\n      setAcState(updatedState);\r\n      \r\n      // Sync lại local state để UI đồng bộ\r\n      if (updatedState.powerState !== undefined) setLocalPower(updatedState.powerState);\r\n      if (updatedState.mode) setLocalMode(updatedState.mode);\r\n      if (updatedState.fanSpeed) setLocalFan(updatedState.fanSpeed);\r\n      if (typeof updatedState.targetTemperature === 'number') {\r\n        setLocalTemp(updatedState.targetTemperature);\r\n      }\r\n\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Failed to update settings. Please try again.\");\r\n    } finally {\r\n      setSaving(false);\r\n      isSavingRef.current = false;\r\n    }\r\n  }\r\n\r\n  const isOverride = acState?.overrideActive;\r\n  const currentTempDisplay = acState?.currentTemperature != null ? acState.currentTemperature.toFixed(1) : \"--\";\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200\">\r\n      <div className=\"absolute inset-0\" onClick={onClose}></div>\r\n\r\n      <div className=\"relative w-full max-w-sm bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"bg-white px-6 py-4 flex items-center justify-between border-b border-gray-100 sticky top-0 z-10\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${localPower ? 'bg-blue-100 text-blue-600' : 'bg-gray-100 text-gray-400'}`}>\r\n              <Wind size={20} />\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-lg font-bold text-gray-900 leading-none\">\r\n                {device.name || \"AC Unit\"}\r\n              </h2>\r\n              <span className=\"text-xs text-gray-500 font-medium\">\r\n                {device.model || \"Smart Air Conditioner\"}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-full text-gray-500 transition-colors\">\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6 overflow-y-auto custom-scrollbar\">\r\n          \r\n          {/* Status Banner */}\r\n          <div className={`rounded-xl p-3 flex items-start gap-3 border ${isOverride ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`}>\r\n            <div className={`mt-0.5 ${isOverride ? 'text-green-600' : 'text-gray-500'}`}>\r\n              {isOverride ? <Clock size={16} /> : <Zap size={16} />}\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <p className={`text-sm font-bold ${isOverride ? 'text-green-800' : 'text-gray-700'}`}>\r\n                {isOverride ? \"Manual Override Active\" : \"Auto Schedule Mode\"}\r\n              </p>\r\n              {isOverride ? (\r\n                <div className=\"mt-1 text-xs text-green-700 space-y-0.5\">\r\n                  <p>\r\n                    Ends at <strong>{acState?.overrideExpiresOnLocalFormatted?.split(' ')[0]}</strong>\r\n                  </p>\r\n                  <p className=\"flex items-center gap-1 opacity-90\">\r\n                    <User size={10} /> By {acState?.lastUpdatedBy || \"User\"}\r\n                  </p>\r\n                </div>\r\n              ) : (\r\n                <p className=\"text-xs text-gray-500 mt-0.5\">System is running automatically.</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* --- POWER CONTROL --- */}\r\n          <div className=\"flex items-center justify-between bg-gray-50 rounded-2xl p-4 border border-gray-100\">\r\n            <span className=\"font-bold text-gray-700 text-sm uppercase tracking-wider\">Power</span>\r\n            <button\r\n              onClick={() => handleUpdate({ powerState: !localPower })}\r\n              disabled={saving}\r\n              className={`relative w-14 h-8 rounded-full transition-colors duration-300 focus:outline-none ${localPower ? \"bg-blue-500\" : \"bg-gray-300\"}`}\r\n            >\r\n              <div className={`absolute top-1 left-1 bg-white w-6 h-6 rounded-full shadow-md transform transition-transform duration-300 ${localPower ? \"translate-x-6\" : \"\"}`} />\r\n            </button>\r\n          </div>\r\n\r\n          {/* --- Temperature Control --- */}\r\n          <div className={`rounded-3xl p-6 text-center transition-all duration-300 ${\r\n            localPower \r\n              ? \"bg-gradient-to-br from-cyan-500 to-blue-600 text-white shadow-lg shadow-blue-200\" \r\n              : \"bg-gray-50 border-2 border-gray-100 text-gray-400\"\r\n          }`}>\r\n            <p className={`text-xs font-bold uppercase tracking-widest mb-4 ${localPower ? 'opacity-80' : 'text-gray-500'}`}>Target Temperature</p>\r\n            \r\n            <div className=\"flex items-center justify-center gap-6\">\r\n              <button\r\n                onClick={() => handleUpdate({ targetTemperature: Math.max(16, localTemp - 1) })}\r\n                disabled={!localPower || saving}\r\n                className={`w-12 h-12 rounded-full flex items-center justify-center transition-all active:scale-95 disabled:opacity-30 disabled:cursor-not-allowed ${\r\n                    localPower ? \"bg-white/20 hover:bg-white/30\" : \"bg-gray-200 text-gray-500\"\r\n                }`}\r\n              >\r\n                <Minus size={24} />\r\n              </button>\r\n              \r\n              <div className=\"flex items-start\">\r\n                <span className=\"text-7xl font-bold tracking-tighter leading-none\">{localTemp}</span>\r\n                <span className=\"text-3xl font-light mt-1\">°</span>\r\n              </div>\r\n\r\n              <button\r\n                onClick={() => handleUpdate({ targetTemperature: Math.min(30, localTemp + 1) })}\r\n                disabled={!localPower || saving}\r\n                className={`w-12 h-12 rounded-full flex items-center justify-center transition-all active:scale-95 disabled:opacity-30 disabled:cursor-not-allowed ${\r\n                    localPower ? \"bg-white/20 hover:bg-white/30\" : \"bg-gray-200 text-gray-500\"\r\n                }`}\r\n              >\r\n                <Plus size={24} />\r\n              </button>\r\n            </div>\r\n\r\n            <div className={`mt-6 inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium ${\r\n                localPower ? \"bg-black/10 backdrop-blur-md\" : \"bg-gray-200 text-gray-500\"\r\n            }`}>\r\n              <Wind size={12} /> Room Temp: {currentTempDisplay}°C\r\n            </div>\r\n          </div>\r\n\r\n          {/* Settings Group */}\r\n          <div className=\"space-y-4\">\r\n            {/* Mode */}\r\n            <div>\r\n              <p className=\"text-xs font-bold text-gray-400 uppercase mb-2\">Mode</p>\r\n              <div className=\"flex bg-gray-100 p-1 rounded-xl\">\r\n                {[\"cool\", \"eco\"].map((m) => (\r\n                  <button\r\n                    key={m}\r\n                    onClick={() => handleUpdate({ mode: m })}\r\n                    disabled={!localPower}\r\n                    className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${\r\n                      localMode === m \r\n                        ? \"bg-white text-blue-600 shadow-sm border border-gray-100\" \r\n                        : \"text-gray-500 hover:text-gray-700\"\r\n                    } disabled:opacity-50`}\r\n                  >\r\n                    {m === \"cool\" ? \"Cool\" : \"Eco\"}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Fan Speed */}\r\n            <div>\r\n              <p className=\"text-xs font-bold text-gray-400 uppercase mb-2\">Fan Speed</p>\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                {[\"auto\", \"low\", \"medium\", \"high\"].map((s) => (\r\n                  <button\r\n                    key={s}\r\n                    onClick={() => handleUpdate({ fanSpeed: s })}\r\n                    disabled={!localPower}\r\n                    className={`py-2 rounded-lg text-xs font-bold uppercase border transition-all ${\r\n                      localFan === s\r\n                        ? \"bg-blue-50 border-blue-200 text-blue-700\"\r\n                        : \"bg-white border-gray-100 text-gray-500 hover:border-gray-200\"\r\n                    } disabled:opacity-50`}\r\n                  >\r\n                    {s === \"medium\" ? \"Med\" : s}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Override Duration Slider (Updated: 1min to 4h) */}\r\n          <div className=\"bg-gray-50 rounded-2xl p-5 border border-gray-100\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div className=\"flex items-center gap-2 text-gray-700\">\r\n                <Clock size={16} className=\"text-blue-600\" />\r\n                <span className=\"font-bold text-sm\">Hold Settings For</span>\r\n              </div>\r\n              <span className=\"text-blue-700 font-bold bg-blue-50 px-2 py-0.5 rounded text-sm min-w-[60px] text-center\">\r\n                {formatDuration(overrideDuration)}\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"relative h-6 flex items-center\">\r\n              <input\r\n                type=\"range\"\r\n                min=\"1\"    // FIX: Bắt đầu từ 1 phút\r\n                max=\"240\"\r\n                step=\"1\"   // FIX: Bước nhảy 1 phút\r\n                value={overrideDuration}\r\n                onChange={(e) => setOverrideDuration(Number(e.target.value))}\r\n                className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600 z-10\"\r\n              />\r\n              \r\n              {/* Visual Ticks (0h, 1h, 2h, 3h, 4h) */}\r\n              <div className=\"absolute w-full flex justify-between px-1 pointer-events-none\">\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 1 ? 'bg-blue-600' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 60 ? 'bg-blue-600' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 120 ? 'bg-blue-600' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 180 ? 'bg-blue-600' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 240 ? 'bg-blue-600' : 'bg-gray-300'}`} />\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex justify-between text-xs text-gray-400 mt-2 font-medium\">\r\n              <span>1m</span>\r\n              <span className=\"pl-2\">1h</span>\r\n              <span className=\"pl-1\">2h</span>\r\n              <span className=\"pl-1\">3h</span>\r\n              <span>4h</span>\r\n            </div>\r\n\r\n            <p className=\"text-xs text-center text-gray-500 mt-3 border-t border-gray-200 pt-3\">\r\n              Will return to schedule at <span className=\"font-bold text-gray-800\">{getEndTimeString(overrideDuration)}</span>\r\n            </p>\r\n          </div>\r\n\r\n        </div>\r\n\r\n        {/* Footer Actions */}\r\n        <div className=\"p-5 border-t border-gray-100 bg-white sticky bottom-0 z-10\">\r\n          <button\r\n            onClick={onApplyChanges}\r\n            disabled={saving}\r\n            className=\"w-full py-3.5 rounded-xl bg-green-600 hover:bg-green-700 active:bg-green-800 text-white font-bold text-base shadow-lg shadow-green-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n          >\r\n            {saving ? (\r\n              <>\r\n                <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                <span>Applying...</span>\r\n              </>\r\n            ) : (\r\n              \"Apply Settings\"\r\n            )}\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AALA;;;;;;AAae,SAAS,cAAc,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAsB;IACnF,MAAM,WAAW,OAAO,EAAE;IAE1B,aAAa;IACb,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAiB;IAEvD,kCAAkC;IAClC,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAU,OAAO,UAAU,IAAI;IAC3E,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAS,OAAO,IAAI,IAAI;IAClE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAS,OAAO,QAAQ,IAAI;IACpE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAS,OAAO,iBAAiB,IAAI;IAE/E,4CAA4C;IAC5C,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAS;IAEjE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAAC;IACrC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,MAAM,cAAc,IAAA,+MAAM,EAAC;IAE3B,uCAAuC;IACvC,MAAM,mBAAmB,CAAC;QACxB,MAAM,MAAM,IAAI;QAChB,IAAI,UAAU,CAAC,IAAI,UAAU,KAAK;QAClC,OAAO,IAAI,kBAAkB,CAAC,SAAS;YAAE,MAAM;YAAW,QAAQ;QAAU;IAC9E;IAEA,wCAAwC;IACxC,MAAM,iBAAiB,CAAC;QACtB,MAAM,IAAI,KAAK,KAAK,CAAC,OAAO;QAC5B,MAAM,IAAI,OAAO;QACjB,IAAI,MAAM,GAAG,OAAO,GAAG,EAAE,CAAC,CAAC;QAC3B,IAAI,MAAM,GAAG,OAAO,GAAG,EAAE,CAAC,CAAC;QAC3B,OAAO,GAAG,EAAE,EAAE,EAAE,EAAE,CAAC,CAAC;IACtB;IAEA,MAAM,YAAY,OAAO,gBAAgB,KAAK;QAC5C,IAAI,YAAY,OAAO,IAAI,CAAC,eAAe;QAC3C,IAAI,CAAC,UAAU,CAAC,UAAU;QAE1B,IAAI;YACF,MAAM,QAAQ,MAAM,IAAA,wHAAU,EAAC,QAAQ;YACvC,WAAW;YAEX,IAAI,CAAC,YAAY,OAAO,IAAI,eAAe;gBACzC,IAAI,MAAM,UAAU,KAAK,WAAW,cAAc,MAAM,UAAU;gBAClE,IAAI,MAAM,IAAI,EAAE,aAAa,MAAM,IAAI;gBACvC,IAAI,MAAM,QAAQ,EAAE,YAAY,MAAM,QAAQ;gBAC9C,IAAI,OAAO,MAAM,iBAAiB,KAAK,UAAU;oBAC/C,aAAa,MAAM,iBAAiB;gBACtC;YACF;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC,eAAe;QAC/B,SAAU;YACN,WAAW;QACf;IACF;IAEA,IAAA,kNAAS,EAAC;QACR,YAAY,OAAO,GAAG;QACtB,UAAU;QACV,MAAM,WAAW,YAAY,IAAM,UAAU,QAAQ;QACrD,OAAO,IAAM,cAAc;IAC7B,GAAG;QAAC;QAAQ;KAAS;IAErB,MAAM,eAAe,CAAC;QACpB,IAAI,QAAQ,UAAU,KAAK,WAAW,cAAc,QAAQ,UAAU;QACtE,IAAI,QAAQ,IAAI,EAAE,aAAa,QAAQ,IAAI;QAC3C,IAAI,QAAQ,QAAQ,EAAE,YAAY,QAAQ,QAAQ;QAClD,IAAI,QAAQ,iBAAiB,EAAE,aAAa,QAAQ,iBAAiB;IACvE;IAEA,eAAe;QACb,IAAI;YACF,UAAU;YACV,YAAY,OAAO,GAAG;YAEtB,MAAM,eAAe,MAAM,IAAA,8HAAgB,EAAC,QAAQ,UAAU;gBAC5D,YAAY;gBACZ,MAAM;gBACN,UAAU;gBACV,mBAAmB;gBACnB,MAAM,2HAAY;gBAClB,iBAAiB;YACnB;YAEA,WAAW;YAEX,qCAAqC;YACrC,IAAI,aAAa,UAAU,KAAK,WAAW,cAAc,aAAa,UAAU;YAChF,IAAI,aAAa,IAAI,EAAE,aAAa,aAAa,IAAI;YACrD,IAAI,aAAa,QAAQ,EAAE,YAAY,aAAa,QAAQ;YAC5D,IAAI,OAAO,aAAa,iBAAiB,KAAK,UAAU;gBACtD,aAAa,aAAa,iBAAiB;YAC7C;QAEF,EAAE,OAAO,GAAG;YACV,QAAQ,KAAK,CAAC;YACd,MAAM;QACR,SAAU;YACR,UAAU;YACV,YAAY,OAAO,GAAG;QACxB;IACF;IAEA,MAAM,aAAa,SAAS;IAC5B,MAAM,qBAAqB,SAAS,sBAAsB,OAAO,QAAQ,kBAAkB,CAAC,OAAO,CAAC,KAAK;IAEzG,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;gBAAmB,SAAS;;;;;;0BAE3C,8OAAC;gBAAI,WAAU;;kCAGb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAW,CAAC,0EAA0E,EAAE,aAAa,8BAA8B,6BAA6B;kDACnK,cAAA,8OAAC,0MAAI;4CAAC,MAAM;;;;;;;;;;;kDAEd,8OAAC;;0DACC,8OAAC;gDAAG,WAAU;0DACX,OAAO,IAAI,IAAI;;;;;;0DAElB,8OAAC;gDAAK,WAAU;0DACb,OAAO,KAAK,IAAI;;;;;;;;;;;;;;;;;;0CAIvB,8OAAC;gCAAO,SAAS;gCAAS,WAAU;0CAClC,cAAA,8OAAC,iMAAC;oCAAC,MAAM;;;;;;;;;;;;;;;;;kCAIb,8OAAC;wBAAI,WAAU;;0CAGb,8OAAC;gCAAI,WAAW,CAAC,6CAA6C,EAAE,aAAa,iCAAiC,8BAA8B;;kDAC1I,8OAAC;wCAAI,WAAW,CAAC,OAAO,EAAE,aAAa,mBAAmB,iBAAiB;kDACxE,2BAAa,8OAAC,6MAAK;4CAAC,MAAM;;;;;iEAAS,8OAAC,uMAAG;4CAAC,MAAM;;;;;;;;;;;kDAEjD,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAE,WAAW,CAAC,kBAAkB,EAAE,aAAa,mBAAmB,iBAAiB;0DACjF,aAAa,2BAA2B;;;;;;4CAE1C,2BACC,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;;4DAAE;0EACO,8OAAC;0EAAQ,SAAS,iCAAiC,MAAM,IAAI,CAAC,EAAE;;;;;;;;;;;;kEAE1E,8OAAC;wDAAE,WAAU;;0EACX,8OAAC,0MAAI;gEAAC,MAAM;;;;;;4DAAM;4DAAK,SAAS,iBAAiB;;;;;;;;;;;;qEAIrD,8OAAC;gDAAE,WAAU;0DAA+B;;;;;;;;;;;;;;;;;;0CAMlD,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAK,WAAU;kDAA2D;;;;;;kDAC3E,8OAAC;wCACC,SAAS,IAAM,aAAa;gDAAE,YAAY,CAAC;4CAAW;wCACtD,UAAU;wCACV,WAAW,CAAC,iFAAiF,EAAE,aAAa,gBAAgB,eAAe;kDAE3I,cAAA,8OAAC;4CAAI,WAAW,CAAC,0GAA0G,EAAE,aAAa,kBAAkB,IAAI;;;;;;;;;;;;;;;;;0CAKpK,8OAAC;gCAAI,WAAW,CAAC,wDAAwD,EACvE,aACI,qFACA,qDACJ;;kDACA,8OAAC;wCAAE,WAAW,CAAC,iDAAiD,EAAE,aAAa,eAAe,iBAAiB;kDAAE;;;;;;kDAEjH,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDACC,SAAS,IAAM,aAAa;wDAAE,mBAAmB,KAAK,GAAG,CAAC,IAAI,YAAY;oDAAG;gDAC7E,UAAU,CAAC,cAAc;gDACzB,WAAW,CAAC,uIAAuI,EAC/I,aAAa,kCAAkC,6BACjD;0DAEF,cAAA,8OAAC,6MAAK;oDAAC,MAAM;;;;;;;;;;;0DAGf,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAK,WAAU;kEAAoD;;;;;;kEACpE,8OAAC;wDAAK,WAAU;kEAA2B;;;;;;;;;;;;0DAG7C,8OAAC;gDACC,SAAS,IAAM,aAAa;wDAAE,mBAAmB,KAAK,GAAG,CAAC,IAAI,YAAY;oDAAG;gDAC7E,UAAU,CAAC,cAAc;gDACzB,WAAW,CAAC,uIAAuI,EAC/I,aAAa,kCAAkC,6BACjD;0DAEF,cAAA,8OAAC,0MAAI;oDAAC,MAAM;;;;;;;;;;;;;;;;;kDAIhB,8OAAC;wCAAI,WAAW,CAAC,+EAA+E,EAC5F,aAAa,iCAAiC,6BAChD;;0DACA,8OAAC,0MAAI;gDAAC,MAAM;;;;;;4CAAM;4CAAa;4CAAmB;;;;;;;;;;;;;0CAKtD,8OAAC;gCAAI,WAAU;;kDAEb,8OAAC;;0DACC,8OAAC;gDAAE,WAAU;0DAAiD;;;;;;0DAC9D,8OAAC;gDAAI,WAAU;0DACZ;oDAAC;oDAAQ;iDAAM,CAAC,GAAG,CAAC,CAAC,kBACpB,8OAAC;wDAEC,SAAS,IAAM,aAAa;gEAAE,MAAM;4DAAE;wDACtC,UAAU,CAAC;wDACX,WAAW,CAAC,wDAAwD,EAClE,cAAc,IACV,4DACA,oCACL,oBAAoB,CAAC;kEAErB,MAAM,SAAS,SAAS;uDATpB;;;;;;;;;;;;;;;;kDAgBb,8OAAC;;0DACC,8OAAC;gDAAE,WAAU;0DAAiD;;;;;;0DAC9D,8OAAC;gDAAI,WAAU;0DACZ;oDAAC;oDAAQ;oDAAO;oDAAU;iDAAO,CAAC,GAAG,CAAC,CAAC,kBACtC,8OAAC;wDAEC,SAAS,IAAM,aAAa;gEAAE,UAAU;4DAAE;wDAC1C,UAAU,CAAC;wDACX,WAAW,CAAC,kEAAkE,EAC5E,aAAa,IACT,6CACA,+DACL,oBAAoB,CAAC;kEAErB,MAAM,WAAW,QAAQ;uDATrB;;;;;;;;;;;;;;;;;;;;;;0CAiBf,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAI,WAAU;;kEACb,8OAAC,6MAAK;wDAAC,MAAM;wDAAI,WAAU;;;;;;kEAC3B,8OAAC;wDAAK,WAAU;kEAAoB;;;;;;;;;;;;0DAEtC,8OAAC;gDAAK,WAAU;0DACb,eAAe;;;;;;;;;;;;kDAIpB,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDACC,MAAK;gDACL,KAAI;gDACJ,KAAI;gDACJ,MAAK;gDACL,OAAO;gDACP,UAAU,CAAC,IAAM,oBAAoB,OAAO,EAAE,MAAM,CAAC,KAAK;gDAC1D,WAAU;;;;;;0DAIZ,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAI,WAAW,CAAC,qBAAqB,EAAE,oBAAoB,IAAI,gBAAgB,eAAe;;;;;;kEAC/F,8OAAC;wDAAI,WAAW,CAAC,qBAAqB,EAAE,oBAAoB,KAAK,gBAAgB,eAAe;;;;;;kEAChG,8OAAC;wDAAI,WAAW,CAAC,qBAAqB,EAAE,oBAAoB,MAAM,gBAAgB,eAAe;;;;;;kEACjG,8OAAC;wDAAI,WAAW,CAAC,qBAAqB,EAAE,oBAAoB,MAAM,gBAAgB,eAAe;;;;;;kEACjG,8OAAC;wDAAI,WAAW,CAAC,qBAAqB,EAAE,oBAAoB,MAAM,gBAAgB,eAAe;;;;;;;;;;;;;;;;;;kDAIrG,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;0DAAK;;;;;;0DACN,8OAAC;gDAAK,WAAU;0DAAO;;;;;;0DACvB,8OAAC;gDAAK,WAAU;0DAAO;;;;;;0DACvB,8OAAC;gDAAK,WAAU;0DAAO;;;;;;0DACvB,8OAAC;0DAAK;;;;;;;;;;;;kDAGR,8OAAC;wCAAE,WAAU;;4CAAuE;0DACvD,8OAAC;gDAAK,WAAU;0DAA2B,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;;kCAO7F,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BACC,SAAS;4BACT,UAAU;4BACV,WAAU;sCAET,uBACC;;kDACE,8OAAC;wCAAI,WAAU;;;;;;kDACf,8OAAC;kDAAK;;;;;;;+CAGR;;;;;;;;;;;;;;;;;;;;;;;AAQd"}},
    {"offset": {"line": 1500, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/device-details/light-detail-modal.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useRef } from \"react\"\r\nimport { X, Lightbulb, Clock, Zap, Power, Sun } from \"lucide-react\"\r\nimport { getLightState, updateLightSettings, type LightState } from \"@/lib/api\"\r\nimport { CURRENT_USER } from \"@/lib/user\"\r\n\r\ninterface LightDetailModalProps {\r\n  device: any;\r\n  onClose: () => void;\r\n}\r\n\r\nexport default function LightDetailModal({ device, onClose }: LightDetailModalProps) {\r\n  const roomId = device.roomId; // Lấy roomId từ prop device\r\n  const deviceId = device.id;\r\n\r\n  const [lightState, setLightState] = useState<LightState | null>(null);\r\n  \r\n  // Optimistic UI States\r\n  const [localPower, setLocalPower] = useState<boolean>(device.powerState ?? false);\r\n  const [localBrightness, setLocalBrightness] = useState<number>(device.brightness ?? 80);\r\n  const [overrideDuration, setOverrideDuration] = useState<number>(60);\r\n\r\n  const [saving, setSaving] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const isSavingRef = useRef(false);\r\n\r\n  const getEndTimeString = (minutes: number) => {\r\n    const end = new Date();\r\n    end.setMinutes(end.getMinutes() + minutes);\r\n    return end.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });\r\n  };\r\n\r\n  const fetchData = async () => {\r\n    if (isSavingRef.current || !roomId || !deviceId) return;\r\n\r\n    try {\r\n      const state = await getLightState(roomId, deviceId);\r\n      setLightState(state);\r\n      \r\n      if (!isSavingRef.current) {\r\n        setLocalPower(state.powerState);\r\n        // Chỉ cập nhật brightness nếu API trả về số hợp lệ\r\n        if (typeof state.brightness === 'number') setLocalBrightness(state.brightness);\r\n      }\r\n    } catch (e) {\r\n      console.error(\"Poll error:\", e);\r\n    } finally {\r\n        setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    const interval = setInterval(fetchData, 5000);\r\n    return () => clearInterval(interval);\r\n  }, [roomId, deviceId]);\r\n\r\n  async function onApplyChanges() {\r\n    try {\r\n      setSaving(true);\r\n      isSavingRef.current = true;\r\n\r\n      await updateLightSettings(roomId, deviceId, {\r\n        powerState: localPower,\r\n        brightness: localBrightness,\r\n        durationMinutes: overrideDuration,\r\n      });\r\n\r\n      await fetchData();\r\n      // onClose(); // Giữ modal mở như AC\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(\"Failed to update light settings.\");\r\n    } finally {\r\n      setSaving(false);\r\n      isSavingRef.current = false;\r\n    }\r\n  }\r\n\r\n  const isOverride = lightState?.overrideActive;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200\">\r\n      <div className=\"absolute inset-0\" onClick={onClose}></div>\r\n\r\n      <div className=\"relative w-full max-w-sm bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n        \r\n        {/* Header */}\r\n        <div className=\"bg-white px-6 py-4 flex items-center justify-between border-b border-gray-100 sticky top-0 z-10\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${localPower ? 'bg-amber-100 text-amber-600' : 'bg-gray-100 text-gray-400'}`}>\r\n              <Lightbulb size={20} />\r\n            </div>\r\n            <div>\r\n              <h2 className=\"text-lg font-bold text-gray-900 leading-none\">\r\n                {device.name || \"Smart Light\"}\r\n              </h2>\r\n              <span className=\"text-xs text-gray-500 font-medium\">\r\n                {device.model || \"Light Switch\"}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <button onClick={onClose} className=\"p-2 hover:bg-gray-100 rounded-full text-gray-500 transition-colors\">\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"p-6 space-y-6 overflow-y-auto custom-scrollbar\">\r\n          \r\n          {/* Status Badge */}\r\n          <div className={`rounded-xl p-3 flex items-start gap-3 border ${isOverride ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}`}>\r\n            <div className={`mt-0.5 ${isOverride ? 'text-green-600' : 'text-gray-500'}`}>\r\n              {isOverride ? <Clock size={16} /> : <Zap size={16} />}\r\n            </div>\r\n            <div className=\"flex-1\">\r\n              <p className={`text-sm font-bold ${isOverride ? 'text-green-800' : 'text-gray-700'}`}>\r\n                {isOverride ? \"Manual Override Active\" : \"Auto Schedule Mode\"}\r\n              </p>\r\n              {isOverride ? (\r\n                <p className=\"text-xs text-green-700 mt-0.5\">\r\n                  Ends at <strong>{lightState?.overrideExpiresOnLocalFormatted?.split(' ')[0]}</strong> • By {lightState?.controlMode === 'manual-override' ? CURRENT_USER : 'System'}\r\n                </p>\r\n              ) : (\r\n                <p className=\"text-xs text-gray-500 mt-0.5\">Light is controlled automatically.</p>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Power Control */}\r\n          <div className=\"flex items-center justify-between bg-gray-50 rounded-2xl p-4 border border-gray-100\">\r\n            <span className=\"font-bold text-gray-700 text-sm uppercase tracking-wider\">Power</span>\r\n            <button\r\n              onClick={() => setLocalPower(!localPower)}\r\n              disabled={saving}\r\n              className={`relative w-14 h-8 rounded-full transition-colors duration-300 focus:outline-none ${localPower ? \"bg-amber-500\" : \"bg-gray-300\"}`}\r\n            >\r\n              <div className={`absolute top-1 left-1 bg-white w-6 h-6 rounded-full shadow-md transform transition-transform duration-300 ${localPower ? \"translate-x-6\" : \"\"}`} />\r\n            </button>\r\n          </div>\r\n\r\n          {/* Brightness Control (Amber/Yellow Theme) */}\r\n          <div className={`rounded-3xl p-6 text-center transition-all duration-300 ${\r\n            localPower \r\n              ? \"bg-gradient-to-br from-amber-400 to-orange-500 text-white shadow-lg shadow-orange-200\" \r\n              : \"bg-gray-50 border-2 border-gray-100 text-gray-400\"\r\n          }`}>\r\n            \r\n            <div className=\"flex items-center justify-between mb-6 px-2\">\r\n                <p className={`text-xs font-bold uppercase tracking-widest ${localPower ? 'opacity-90' : 'text-gray-500'}`}>Brightness Level</p>\r\n                <Sun size={18} className={localPower ? 'opacity-90' : 'text-gray-400'} />\r\n            </div>\r\n\r\n            <div className=\"relative flex flex-col items-center justify-center py-2\">\r\n                <span className=\"text-7xl font-bold tracking-tighter leading-none\">{localBrightness}%</span>\r\n                \r\n                {/* Brightness Slider */}\r\n                <input\r\n                    type=\"range\"\r\n                    min=\"0\"\r\n                    max=\"100\"\r\n                    step=\"5\"\r\n                    value={localBrightness}\r\n                    onChange={(e) => setLocalBrightness(Number(e.target.value))}\r\n                    disabled={!localPower || saving}\r\n                    className=\"w-full h-2 mt-6 bg-white/30 rounded-lg appearance-none cursor-pointer accent-white hover:accent-gray-50\"\r\n                />\r\n                <div className=\"w-full flex justify-between text-[10px] font-medium mt-2 opacity-80\">\r\n                    <span>0%</span>\r\n                    <span>50%</span>\r\n                    <span>100%</span>\r\n                </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Override Duration Slider */}\r\n          <div className=\"bg-gray-50 rounded-2xl p-5 border border-gray-100\">\r\n            <div className=\"flex items-center justify-between mb-4\">\r\n              <div className=\"flex items-center gap-2 text-gray-700\">\r\n                <Clock size={16} className=\"text-amber-600\" />\r\n                <span className=\"font-bold text-sm\">Hold Settings For</span>\r\n              </div>\r\n              <span className=\"text-amber-700 font-bold bg-amber-100 px-2 py-0.5 rounded text-sm\">\r\n                {overrideDuration < 60 ? `${overrideDuration}m` : `${overrideDuration/60}h`}\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"relative h-6 flex items-center\">\r\n              <input\r\n                type=\"range\"\r\n                min=\"30\"\r\n                max=\"240\"\r\n                step=\"30\"\r\n                value={overrideDuration}\r\n                onChange={(e) => setOverrideDuration(Number(e.target.value))}\r\n                className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-amber-500 z-10\"\r\n              />\r\n              <div className=\"absolute w-full flex justify-between px-1 pointer-events-none\">\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 30 ? 'bg-amber-500' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 60 ? 'bg-amber-500' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 120 ? 'bg-amber-500' : 'bg-gray-300'}`} />\r\n                <div className={`w-1 h-1 rounded-full ${overrideDuration >= 240 ? 'bg-amber-500' : 'bg-gray-300'}`} />\r\n              </div>\r\n            </div>\r\n            \r\n            <p className=\"text-xs text-center text-gray-500 mt-3 border-t border-gray-200 pt-3\">\r\n              Will return to schedule at <span className=\"font-bold text-gray-800\">{getEndTimeString(overrideDuration)}</span>\r\n            </p>\r\n          </div>\r\n\r\n        </div>\r\n\r\n        {/* Footer Actions - Giữ màu Xanh lá */}\r\n        <div className=\"p-5 border-t border-gray-100 bg-white sticky bottom-0 z-10\">\r\n          <button\r\n            onClick={onApplyChanges}\r\n            disabled={saving}\r\n            className=\"w-full py-3.5 rounded-xl bg-green-600 hover:bg-green-700 active:bg-green-800 text-white font-bold text-base shadow-lg shadow-green-200 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n          >\r\n            {saving ? \"Applying...\" : \"Apply Settings\"}\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2041, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/detail-tabs/devices-tab.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport {\r\n  Wind,\r\n  Lightbulb,\r\n  Thermometer,\r\n  Droplets,\r\n  Activity,\r\n  Zap,\r\n} from \"lucide-react\";\r\nimport ACDetailModal from \"@/components/device-details/ac-detail-modal\";\r\nimport LightDetailModal from \"@/components/device-details/light-detail-modal\";\r\n\r\nimport type { Room, Device } from \"@/lib/api\";\r\nimport { getDevicesForRoom } from \"@/lib/api\";\r\n\r\ninterface DevicesTabProps {\r\n  room: Room;\r\n}\r\n\r\n/**\r\n * Tạm thời Azure trả về device.type khá generic (sensor / device),\r\n * nên mình thử đoán loại dựa trên type + name để hiển thị icon & group.\r\n */\r\nfunction classifyDevice(device: Device): {\r\n  baseType: \"ac\" | \"light\" | \"sensor\" | \"other\";\r\n  sensorType?: \"temperature\" | \"humidity\" | \"motion\" | \"energy\" | \"other\";\r\n} {\r\n  const t = (device.type || \"\").toLowerCase();\r\n  const n = (device.name || \"\").toLowerCase();\r\n\r\n  // 👉 ƯU TIÊN SENSOR: nếu type hoặc name có chữ \"sensor\"\r\n  if (t.includes(\"sensor\") || n.includes(\"sensor\")) {\r\n    if (n.includes(\"temp\")) return { baseType: \"sensor\", sensorType: \"temperature\" };\r\n    if (n.includes(\"humid\")) return { baseType: \"sensor\", sensorType: \"humidity\" };\r\n    if (n.includes(\"motion\") || n.includes(\"pir\"))\r\n      return { baseType: \"sensor\", sensorType: \"motion\" };\r\n    if (n.includes(\"energy\") || n.includes(\"meter\"))\r\n      return { baseType: \"sensor\", sensorType: \"energy\" };\r\n    if (n.includes(\"light\") || n.includes(\"lux\"))\r\n      return { baseType: \"sensor\", sensorType: \"other\" }; // light sensor\r\n    return { baseType: \"sensor\", sensorType: \"other\" };\r\n  }\r\n\r\n  // Đoán AC từ type/name\r\n  if (t.includes(\"ac\") || t.includes(\"hvac\") || n.includes(\"ac\")) {\r\n    return { baseType: \"ac\" };\r\n  }\r\n\r\n  // Đoán light từ type/name\r\n  if (t.includes(\"light\") || n.includes(\"light\")) {\r\n    return { baseType: \"light\" };\r\n  }\r\n\r\n  return { baseType: \"other\" };\r\n}\r\n\r\n\r\nfunction getDeviceIcon(baseType: string, sensorType?: string) {\r\n  switch (baseType) {\r\n    case \"ac\":\r\n      return <Wind size={22} />;\r\n    case \"light\":\r\n      return <Lightbulb size={22} />;\r\n    case \"sensor\":\r\n      switch (sensorType) {\r\n        case \"temperature\":\r\n          return <Thermometer size={22} />;\r\n        case \"humidity\":\r\n          return <Droplets size={22} />;\r\n        case \"motion\":\r\n          return <Activity size={22} />;\r\n        case \"energy\":\r\n          return <Zap size={22} />;\r\n        default:\r\n          return <Activity size={22} />;\r\n      }\r\n    default:\r\n      return <Zap size={22} />;\r\n  }\r\n}\r\n\r\nfunction getIconBgColor(baseType: string, sensorType?: string) {\r\n  if (baseType === \"ac\") return \"bg-blue-50 text-blue-600\";\r\n  if (baseType === \"light\") return \"bg-yellow-50 text-yellow-600\";\r\n  if (baseType === \"sensor\") {\r\n    switch (sensorType) {\r\n      case \"temperature\":\r\n        return \"bg-orange-50 text-orange-600\";\r\n      case \"humidity\":\r\n        return \"bg-cyan-50 text-cyan-600\";\r\n      case \"motion\":\r\n        return \"bg-purple-50 text-purple-600\";\r\n      case \"energy\":\r\n        return \"bg-amber-50 text-amber-600\";\r\n      default:\r\n        return \"bg-gray-50 text-gray-600\";\r\n    }\r\n  }\r\n  return \"bg-gray-50 text-gray-600\";\r\n}\r\n\r\nexport default function DevicesTab({ room }: DevicesTabProps) {\r\n  const [devices, setDevices] = useState<Device[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  type ClassifiedDevice = Device & {\r\n    baseType: \"ac\" | \"light\" | \"sensor\" | \"other\";\r\n    sensorType?: \"temperature\" | \"humidity\" | \"motion\" | \"energy\" | \"other\";\r\n  };\r\n  const [selectedDevice, setSelectedDevice] = useState<ClassifiedDevice | null>(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    async function load() {\r\n      try {\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        const data = await getDevicesForRoom(room.id);\r\n\r\n        if (!cancelled) {\r\n          setDevices(data);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Failed to load devices\", err);\r\n        if (!cancelled) setError(\"Failed to load devices\");\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    }\r\n\r\n    load();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [room.id]);\r\n\r\n  const enriched = devices.map((d) => {\r\n    const cls = classifyDevice(d);\r\n    return { ...d, ...cls };\r\n  });\r\n\r\n  const controllableDevices = enriched.filter(\r\n    (d) => d.baseType === \"ac\" || d.baseType === \"light\"\r\n  );\r\n  const sensors = enriched.filter((d) => d.baseType === \"sensor\");\r\n\r\n  if (loading) {\r\n    return <div className=\"text-sm text-gray-500 px-1 py-4\">Loading devices…</div>;\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"text-sm text-red-500 px-1 py-4\">\r\n        {error}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Controllable Devices */}\r\n      <div>\r\n        <h3 className=\"text-sm font-semibold text-gray-600 uppercase tracking-wide mb-3 px-1\">\r\n          Controllable Devices\r\n        </h3>\r\n        {controllableDevices.length === 0 && (\r\n          <p className=\"text-xs text-gray-500 px-1\">\r\n            No controllable devices detected for this room.\r\n          </p>\r\n        )}\r\n        <div className=\"space-y-3\">\r\n          {controllableDevices.map((device) => (\r\n            <button\r\n              key={device.id}\r\n              onClick={() => setSelectedDevice(device)}\r\n              className=\"bg-white rounded-2xl p-5 w-full text-left hover:shadow-md transition-all border border-gray-100 hover:border-green-200\"\r\n            >\r\n              <div className=\"flex items-start justify-between mb-2\">\r\n                <div className=\"flex items-start gap-4 flex-1\">\r\n                  <div\r\n                    className={`w-12 h-12 rounded-xl flex items-center justify-center ${getIconBgColor(\r\n                      device.baseType!,\r\n                      device.sensorType as any\r\n                    )}`}\r\n                  >\r\n                    {getDeviceIcon(device.baseType!, device.sensorType)}\r\n                  </div>\r\n                  <div className=\"flex-1\">\r\n                    <h4 className=\"font-semibold text-gray-900 mb-1\">\r\n                      {device.name}\r\n                    </h4>\r\n                    <p className=\"text-xs text-gray-500\">\r\n                      {device.type} • {device.id}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <span\r\n                  className={`px-3 py-1 rounded-full text-xs font-medium ${\r\n                    (device.status || \"\").toLowerCase() === \"online\"\r\n                      ? \"bg-green-50 text-green-700\"\r\n                      : \"bg-gray-100 text-gray-700\"\r\n                  }`}\r\n                >\r\n                  {device.status || \"unknown\"}\r\n                </span>\r\n              </div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Sensors */}\r\n      <div>\r\n        <h3 className=\"text-sm font-semibold text-gray-600 uppercase tracking-wide mb-3 px-1\">\r\n          Sensors (Read-only)\r\n        </h3>\r\n        {sensors.length === 0 && (\r\n          <p className=\"text-xs text-gray-500 px-1\">\r\n            No sensors detected for this room.\r\n          </p>\r\n        )}\r\n        <div className=\"grid grid-cols-2 gap-3\">\r\n          {sensors.map((device) => (\r\n            <div\r\n              key={device.id}\r\n              className=\"bg-white rounded-2xl p-4 border border-gray-100\"\r\n            >\r\n              <div className=\"flex items-center gap-3 mb-3\">\r\n                <div\r\n                  className={`w-10 h-10 rounded-xl flex items-center justify-center ${getIconBgColor(\r\n                    device.baseType!,\r\n                    device.sensorType as any\r\n                  )}`}\r\n                >\r\n                  {getDeviceIcon(device.baseType!, device.sensorType)}\r\n                </div>\r\n                <div>\r\n                  <h4 className=\"font-semibold text-gray-900 text-sm\">\r\n                    {device.name}\r\n                  </h4>\r\n                  <p className=\"text-xs text-gray-500\">{device.type}</p>\r\n                </div>\r\n              </div>\r\n              <p className=\"text-xs text-gray-500\">\r\n                Status:{\" \"}\r\n                <span className=\"font-medium text-gray-800\">\r\n                  {device.status || \"unknown\"}\r\n                </span>\r\n              </p>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Device Detail Modals (chỉ mở nếu sau này có AC / Light thật) */}\r\n      {selectedDevice && selectedDevice.baseType === \"ac\" && (\r\n        <ACDetailModal\r\n          device={selectedDevice}\r\n          roomId={room.id}\r\n          onClose={() => setSelectedDevice(null)}\r\n        />\r\n      )}\r\n      {selectedDevice && selectedDevice.baseType === \"light\" && (\r\n        <LightDetailModal\r\n          device={selectedDevice}\r\n          onClose={() => setSelectedDevice(null)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2493, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/detail-tabs/schedule-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { Clock, Edit2 } from 'lucide-react'\r\n\r\ninterface ScheduleTabProps {\r\n  room: any\r\n}\r\n\r\nconst mockSchedules = [\r\n  {\r\n    id: '1',\r\n    courseName: 'Data Networks',\r\n    lecturer: 'Dr. Smith',\r\n    weekdays: ['MON', 'WED', 'FRI'],\r\n    startTime: '09:00',\r\n    endTime: '10:30',\r\n    enabled: true,\r\n  },\r\n  {\r\n    id: '2',\r\n    courseName: 'Advanced Python',\r\n    lecturer: 'Prof. Brown',\r\n    weekdays: ['TUE', 'THU'],\r\n    startTime: '13:30',\r\n    endTime: '15:00',\r\n    enabled: true,\r\n  },\r\n  {\r\n    id: '3',\r\n    courseName: 'Web Development',\r\n    lecturer: 'Dr. Lee',\r\n    weekdays: ['MON', 'WED'],\r\n    startTime: '15:30',\r\n    endTime: '17:00',\r\n    enabled: false,\r\n  },\r\n]\r\n\r\nexport default function ScheduleTab({ room }: ScheduleTabProps) {\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between mb-6\">\r\n        <h3 className=\"font-semibold text-gray-900\">Classroom Schedule</h3>\r\n        <button className=\"text-emerald-600 hover:text-emerald-700 text-sm font-medium flex items-center gap-1\">\r\n          <Edit2 size={16} />\r\n          Edit\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"space-y-3\">\r\n        {mockSchedules.map((schedule) => (\r\n          <div\r\n            key={schedule.id}\r\n            className={`glass-panel p-5 border-l-4 ${\r\n              schedule.enabled ? 'border-l-emerald-500' : 'border-l-gray-300'\r\n            }`}\r\n          >\r\n            <div className=\"flex items-start justify-between mb-3\">\r\n              <div>\r\n                <h4 className=\"font-semibold text-gray-900\">{schedule.courseName}</h4>\r\n                <p className=\"text-sm text-gray-600\">{schedule.lecturer}</p>\r\n              </div>\r\n              {!schedule.enabled && (\r\n                <span className=\"px-2 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded\">\r\n                  Disabled\r\n                </span>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2 mb-3 flex-wrap\">\r\n              {schedule.weekdays.map((day) => (\r\n                <span\r\n                  key={day}\r\n                  className=\"px-2 py-1 bg-emerald-50 text-emerald-700 text-xs font-medium rounded\"\r\n                >\r\n                  {day}\r\n                </span>\r\n              ))}\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n              <Clock size={16} />\r\n              <span>\r\n                {schedule.startTime} – {schedule.endTime}\r\n              </span>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      <button className=\"w-full glass-panel p-4 font-medium text-emerald-600 hover:bg-emerald-50 transition-colors mt-6\">\r\n        Add Schedule\r\n      </button>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AAFA;;;AAQA,MAAM,gBAAgB;IACpB;QACE,IAAI;QACJ,YAAY;QACZ,UAAU;QACV,UAAU;YAAC;YAAO;YAAO;SAAM;QAC/B,WAAW;QACX,SAAS;QACT,SAAS;IACX;IACA;QACE,IAAI;QACJ,YAAY;QACZ,UAAU;QACV,UAAU;YAAC;YAAO;SAAM;QACxB,WAAW;QACX,SAAS;QACT,SAAS;IACX;IACA;QACE,IAAI;QACJ,YAAY;QACZ,UAAU;QACV,UAAU;YAAC;YAAO;SAAM;QACxB,WAAW;QACX,SAAS;QACT,SAAS;IACX;CACD;AAEc,SAAS,YAAY,EAAE,IAAI,EAAoB;IAC5D,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAA8B;;;;;;kCAC5C,8OAAC;wBAAO,WAAU;;0CAChB,8OAAC,2MAAK;gCAAC,MAAM;;;;;;4BAAM;;;;;;;;;;;;;0BAKvB,8OAAC;gBAAI,WAAU;0BACZ,cAAc,GAAG,CAAC,CAAC,yBAClB,8OAAC;wBAEC,WAAW,CAAC,2BAA2B,EACrC,SAAS,OAAO,GAAG,yBAAyB,qBAC5C;;0CAEF,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;;0DACC,8OAAC;gDAAG,WAAU;0DAA+B,SAAS,UAAU;;;;;;0DAChE,8OAAC;gDAAE,WAAU;0DAAyB,SAAS,QAAQ;;;;;;;;;;;;oCAExD,CAAC,SAAS,OAAO,kBAChB,8OAAC;wCAAK,WAAU;kDAAkE;;;;;;;;;;;;0CAMtF,8OAAC;gCAAI,WAAU;0CACZ,SAAS,QAAQ,CAAC,GAAG,CAAC,CAAC,oBACtB,8OAAC;wCAEC,WAAU;kDAET;uCAHI;;;;;;;;;;0CAQX,8OAAC;gCAAI,WAAU;;kDACb,8OAAC,6MAAK;wCAAC,MAAM;;;;;;kDACb,8OAAC;;4CACE,SAAS,SAAS;4CAAC;4CAAI,SAAS,OAAO;;;;;;;;;;;;;;uBA/BvC,SAAS,EAAE;;;;;;;;;;0BAsCtB,8OAAC;gBAAO,WAAU;0BAAiG;;;;;;;;;;;;AAKzH"}},
    {"offset": {"line": 2698, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/room-detail-modal.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { X, Clock, Info } from \"lucide-react\"\r\nimport MetricsTab from \"@/components/detail-tabs/metrics-tab\"\r\nimport DevicesTab from \"@/components/detail-tabs/devices-tab\"\r\nimport ScheduleTabDetail from \"@/components/detail-tabs/schedule-tab\"\r\nimport type { Room } from \"@/lib/api\"\r\n\r\ninterface RoomDetailModalProps {\r\n  room: Room\r\n  onClose: () => void\r\n}\r\n\r\nexport default function RoomDetailModal({ room, onClose }: RoomDetailModalProps) {\r\n  const [activeTab, setActiveTab] = useState<\"metrics\" | \"devices\" | \"schedule\">(\"metrics\")\r\n\r\n  // ❗ Sửa lại cho đúng schema mới\r\n  const isActive = room.inClass === true\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/30 z-50 flex items-end\">\r\n      <div className=\"w-full bg-white rounded-t-3xl max-h-[90vh] overflow-y-auto animate-in slide-in-from-bottom duration-300\">\r\n        \r\n        {/* HEADER */}\r\n        <div className=\"sticky top-0 bg-white border-b border-gray-200 p-6 z-10\">\r\n          <div className=\"flex items-start justify-between mb-4\">\r\n            <div className=\"flex-1\">\r\n              <div className=\"flex items-center gap-3 mb-2\">\r\n                <div\r\n                  className={`w-3 h-3 rounded-full ${\r\n                    isActive ? \"bg-green-500 shadow-sm shadow-green-500/50\" : \"bg-gray-400\"\r\n                  }`}\r\n                />\r\n                <h2 className=\"text-2xl font-bold text-gray-900\">{room.name}</h2>\r\n              </div>\r\n\r\n              <p className=\"text-sm text-gray-600\">\r\n                {room.building} • Floor {room.floor ?? \"1\"}\r\n              </p>\r\n            </div>\r\n\r\n            <button\r\n              onClick={onClose}\r\n              className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors\"\r\n            >\r\n              <X size={24} className=\"text-gray-700\" />\r\n            </button>\r\n          </div>\r\n\r\n          {/* CLASS STATUS BOX */}\r\n          {isActive ? (\r\n            <div className=\"bg-green-50 rounded-xl p-4 border border-green-100\">\r\n              <div className=\"flex items-start gap-3\">\r\n                <Clock size={20} className=\"text-green-600 mt-0.5\" />\r\n                <div>\r\n                  <p className=\"font-semibold text-green-900\">In class now</p>\r\n\r\n                  {room.courseName && (\r\n                    <p className=\"text-sm text-green-700 mt-1\">\r\n                      {room.courseName}\r\n                      {room.lecturerName ? ` • ${room.lecturerName}` : \"\"}\r\n                    </p>\r\n                  )}\r\n\r\n                  <p className=\"text-xs text-green-600 mt-1\">\r\n                    {/* TODO: Tính toán sau */}\r\n                    Time left: --\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div className=\"bg-gray-50 rounded-xl p-4 border border-gray-200\">\r\n              <div className=\"flex items-start gap-3\">\r\n                <Info size={20} className=\"text-gray-500 mt-0.5\" />\r\n                <div>\r\n                  <p className=\"font-semibold text-gray-900\">No active class</p>\r\n\r\n                  <p className=\"text-sm text-gray-600 mt-1\">\r\n                    Next class at {room.nextClass ?? \"--\"}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* TABS */}\r\n        <div className=\"sticky top-[180px] bg-white border-b border-gray-100 px-6 py-3 flex gap-2 z-10\">\r\n          {([\"metrics\", \"devices\", \"schedule\"] as const).map((tab) => (\r\n            <button\r\n              key={tab}\r\n              onClick={() => setActiveTab(tab)}\r\n              className={`px-5 py-2.5 rounded-xl font-medium text-sm transition-all ${\r\n                activeTab === tab\r\n                  ? \"bg-green-600 text-white shadow-sm\"\r\n                  : \"bg-gray-50 text-gray-700 hover:bg-gray-100\"\r\n              }`}\r\n            >\r\n              {tab.charAt(0).toUpperCase() + tab.slice(1)}\r\n            </button>\r\n          ))}\r\n        </div>\r\n\r\n        {/* TAB CONTENT */}\r\n        <div className=\"p-6 pb-12\">\r\n          {activeTab === \"metrics\" && <MetricsTab room={room} />}\r\n          {activeTab === \"devices\" && <DevicesTab room={room} />}\r\n          {activeTab === \"schedule\" && <ScheduleTabDetail room={room} />}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AANA;;;;;;;AAce,SAAS,gBAAgB,EAAE,IAAI,EAAE,OAAO,EAAwB;IAC7E,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAqC;IAE/E,gCAAgC;IAChC,MAAM,WAAW,KAAK,OAAO,KAAK;IAElC,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BAGb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDACC,WAAW,CAAC,qBAAqB,EAC/B,WAAW,+CAA+C,eAC1D;;;;;;8DAEJ,8OAAC;oDAAG,WAAU;8DAAoC,KAAK,IAAI;;;;;;;;;;;;sDAG7D,8OAAC;4CAAE,WAAU;;gDACV,KAAK,QAAQ;gDAAC;gDAAU,KAAK,KAAK,IAAI;;;;;;;;;;;;;8CAI3C,8OAAC;oCACC,SAAS;oCACT,WAAU;8CAEV,cAAA,8OAAC,iMAAC;wCAAC,MAAM;wCAAI,WAAU;;;;;;;;;;;;;;;;;wBAK1B,yBACC,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC,6MAAK;wCAAC,MAAM;wCAAI,WAAU;;;;;;kDAC3B,8OAAC;;0DACC,8OAAC;gDAAE,WAAU;0DAA+B;;;;;;4CAE3C,KAAK,UAAU,kBACd,8OAAC;gDAAE,WAAU;;oDACV,KAAK,UAAU;oDACf,KAAK,YAAY,GAAG,CAAC,GAAG,EAAE,KAAK,YAAY,EAAE,GAAG;;;;;;;0DAIrD,8OAAC;gDAAE,WAAU;0DACgB;;;;;;;;;;;;;;;;;;;;;;iDAOnC,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC;gCAAI,WAAU;;kDACb,8OAAC,0MAAI;wCAAC,MAAM;wCAAI,WAAU;;;;;;kDAC1B,8OAAC;;0DACC,8OAAC;gDAAE,WAAU;0DAA8B;;;;;;0DAE3C,8OAAC;gDAAE,WAAU;;oDAA6B;oDACzB,KAAK,SAAS,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BAS7C,8OAAC;oBAAI,WAAU;8BACZ,AAAC;wBAAC;wBAAW;wBAAW;qBAAW,CAAW,GAAG,CAAC,CAAC,oBAClD,8OAAC;4BAEC,SAAS,IAAM,aAAa;4BAC5B,WAAW,CAAC,0DAA0D,EACpE,cAAc,MACV,sCACA,8CACJ;sCAED,IAAI,MAAM,CAAC,GAAG,WAAW,KAAK,IAAI,KAAK,CAAC;2BARpC;;;;;;;;;;8BAcX,8OAAC;oBAAI,WAAU;;wBACZ,cAAc,2BAAa,8OAAC,0JAAU;4BAAC,MAAM;;;;;;wBAC7C,cAAc,2BAAa,8OAAC,0JAAU;4BAAC,MAAM;;;;;;wBAC7C,cAAc,4BAAc,8OAAC,2JAAiB;4BAAC,MAAM;;;;;;;;;;;;;;;;;;;;;;;AAKhE"}},
    {"offset": {"line": 2980, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/tabs/home-tab.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { User, Zap, Building2, ThermometerSun } from \"lucide-react\"\r\nimport RoomCard from \"@/components/room-card\"\r\nimport RoomDetailModal from \"@/components/room-detail-modal\"\r\nimport { getRooms, type Room } from \"@/lib/api\"\r\n\r\nexport default function HomeTab() {\r\n  const [rooms, setRooms] = useState<Room[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [selectedRoom, setSelectedRoom] = useState<Room | null>(null)\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      try {\r\n        const data = await getRooms()\r\n        setRooms(data)\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n    load()\r\n  }, [])\r\n\r\n  const totalEnergyKWh = rooms.reduce(\r\n    (sum, room) => sum + (room.currentEnergyKWh ?? 0),\r\n    0\r\n  )\r\n\r\n  const activeRooms = rooms.filter((r) => r.inClass).length\r\n\r\n  const avgTemp =\r\n    rooms.length > 0\r\n      ? rooms.reduce(\r\n          (sum, room) => sum + (room.currentTemperature ?? 0),\r\n          0\r\n        ) / rooms.length\r\n      : 0\r\n\r\n  const today = new Date()\r\n  const dateString = today.toLocaleDateString(\"en-US\", {\r\n    weekday: \"long\",\r\n    month: \"short\",\r\n    day: \"numeric\",\r\n  })\r\n\r\n  return (\r\n    <div className=\"px-4 pt-6 pb-8\">\r\n      {/* Header */}\r\n      <div className=\"flex items-start justify-between mb-6\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold text-gray-900 mb-1\">\r\n            GreenTwin Campus\r\n          </h1>\r\n          <p className=\"text-sm text-gray-600\">Today, {dateString}</p>\r\n        </div>\r\n        <button className=\"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors\">\r\n          <User size={20} className=\"text-gray-600\" />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Overview */}\r\n      <div className=\"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6\">\r\n        <h3 className=\"text-sm font-semibold text-gray-600 mb-4 uppercase tracking-wide\">\r\n          Today&apos;s Overview\r\n        </h3>\r\n\r\n        {loading ? (\r\n          <p className=\"text-sm text-gray-500\">Loading summary…</p>\r\n        ) : (\r\n          <div className=\"grid grid-cols-3 gap-4\">\r\n            <div className=\"text-center\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-green-50 flex items-center justify-center mx-auto mb-3\">\r\n                <Building2 size={24} className=\"text-green-600\" />\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900\">\r\n                {activeRooms}\r\n              </p>\r\n              <p className=\"text-xs text-gray-600 mt-1\">Rooms in class</p>\r\n            </div>\r\n\r\n            <div className=\"text-center\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-amber-50 flex items-center justify-center mx-auto mb-3\">\r\n                <Zap size={24} className=\"text-amber-600\" />\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900\">\r\n                {totalEnergyKWh.toFixed(1)}\r\n              </p>\r\n              <p className=\"text-xs text-gray-600 mt-1\">kWh Today</p>\r\n            </div>\r\n\r\n            <div className=\"text-center\">\r\n              <div className=\"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center mx-auto mb-3\">\r\n                <ThermometerSun size={24} className=\"text-blue-600\" />\r\n              </div>\r\n              <p className=\"text-2xl font-bold text-gray-900\">\r\n                {avgTemp.toFixed(1)}°C\r\n              </p>\r\n              <p className=\"text-xs text-gray-600 mt-1\">Avg Temp</p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Room list */}\r\n      <div className=\"space-y-3 mb-8\">\r\n        <h2 className=\"text-lg font-semibold text-gray-900 px-1\">\r\n          Classrooms\r\n        </h2>\r\n\r\n        {loading ? (\r\n          <p className=\"px-1 text-sm text-gray-500\">Loading rooms…</p>\r\n        ) : rooms.length > 0 ? (\r\n          rooms.map((room) => (\r\n            <RoomCard\r\n              key={room.id}\r\n              room={room}\r\n              onClick={() => setSelectedRoom(room)}\r\n            />\r\n          ))\r\n        ) : (\r\n          <p className=\"px-1 text-sm text-gray-500\">No rooms available.</p>\r\n        )}\r\n      </div>\r\n\r\n      {/* Room Detail Modal */}\r\n      {selectedRoom && (\r\n        <RoomDetailModal\r\n          room={selectedRoom}\r\n          onClose={() => setSelectedRoom(null)}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3292, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/tabs/rooms-tab.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState, useEffect } from \"react\"\r\nimport { Search } from \"lucide-react\"\r\nimport RoomCard from \"@/components/room-card\"\r\nimport RoomDetailModal from \"@/components/room-detail-modal\"\r\nimport { getRooms, type Room } from \"@/lib/api\"\r\nimport DevicesTab from \"@/components/detail-tabs/devices-tab\"\r\n\r\n\r\nexport default function RoomsTab() {\r\n  const [selectedRoom, setSelectedRoom] = useState<Room | null>(null)\r\n  const [filter, setFilter] = useState<\"all\" | \"active\" | \"idle\">(\"all\")\r\n  const [searchQuery, setSearchQuery] = useState(\"\")\r\n\r\n  const [rooms, setRooms] = useState<Room[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    async function load() {\r\n      try {\r\n        const data = await getRooms()\r\n        console.log(\"Loaded rooms from API:\", data) // DEBUG\r\n        setRooms(data)\r\n      } catch (err) {\r\n        console.error(\"Error loading rooms\", err)\r\n        setRooms([])\r\n      } finally {\r\n        setLoading(false)\r\n      }\r\n    }\r\n\r\n    load()\r\n  }, [])\r\n\r\n  const filteredRooms = rooms.filter((room) => {\r\n    const matchesFilter =\r\n      filter === \"all\" ||\r\n      (filter === \"active\" && room.inClass) ||\r\n      (filter === \"idle\" && !room.inClass)\r\n\r\n    const q = searchQuery.toLowerCase()\r\n    const matchesSearch =\r\n      room.name.toLowerCase().includes(q) ||\r\n      room.building.toLowerCase().includes(q)\r\n\r\n    return matchesFilter && matchesSearch\r\n  })\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"px-4 pt-6 pb-8\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Rooms</h1>\r\n        <div className=\"p-4 text-sm text-gray-500\">Loading rooms…</div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <div className=\"px-4 pt-6 pb-8\">\r\n      <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Rooms</h1>\r\n\r\n      {/* Search Bar */}\r\n      <div className=\"relative mb-4\">\r\n        <Search\r\n          size={20}\r\n          className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\"\r\n        />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search by room or building...\"\r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          className=\"w-full pl-12 pr-4 py-3 bg-white rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-900\"\r\n        />\r\n      </div>\r\n\r\n      {/* Filter Chips */}\r\n      <div className=\"flex gap-2 mb-6\">\r\n        <button\r\n          onClick={() => setFilter(\"all\")}\r\n          className={`px-4 py-2 rounded-lg font-medium text-sm transition-all ${\r\n            filter === \"all\"\r\n              ? \"bg-green-600 text-white shadow-sm\"\r\n              : \"bg-white text-gray-700 border border-gray-200 hover:border-gray-300\"\r\n          }`}\r\n        >\r\n          All Rooms\r\n        </button>\r\n        <button\r\n          onClick={() => setFilter(\"active\")}\r\n          className={`px-4 py-2 rounded-lg font-medium text-sm transition-all ${\r\n            filter === \"active\"\r\n              ? \"bg-green-600 text-white shadow-sm\"\r\n              : \"bg-white text-gray-700 border border-gray-200 hover:border-gray-300\"\r\n          }`}\r\n        >\r\n          In Class\r\n        </button>\r\n        <button\r\n          onClick={() => setFilter(\"idle\")}\r\n          className={`px-4 py-2 rounded-lg font-medium text-sm transition-all ${\r\n            filter === \"idle\"\r\n              ? \"bg-green-600 text-white shadow-sm\"\r\n              : \"bg-white text-gray-700 border border-gray-200 hover:border-gray-300\"\r\n          }`}\r\n        >\r\n          Idle\r\n        </button>\r\n      </div>\r\n\r\n      {/* Room List */}\r\n      {filteredRooms.length > 0 ? (\r\n        <div className=\"space-y-3\">\r\n          {filteredRooms.map((room) => (\r\n            <RoomCard\r\n              key={room.id}\r\n              room={room}\r\n              onClick={() => setSelectedRoom(room)}\r\n            />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <div className=\"text-center py-12\">\r\n          <p className=\"text-gray-500\">No rooms found</p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Room Detail Modal */}\r\n      {selectedRoom && (\r\n        <RoomDetailModal\r\n          room={selectedRoom}\r\n          onClose={() => setSelectedRoom(null)}\r\n        />\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AAUe,SAAS;IACtB,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAc;IAC9D,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,iNAAQ,EAA4B;IAChE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAS,EAAE;IAC7C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACR,eAAe;YACb,IAAI;gBACF,MAAM,OAAO,MAAM,IAAA,sHAAQ;gBAC3B,QAAQ,GAAG,CAAC,0BAA0B,OAAM,QAAQ;gBACpD,SAAS;YACX,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,uBAAuB;gBACrC,SAAS,EAAE;YACb,SAAU;gBACR,WAAW;YACb;QACF;QAEA;IACF,GAAG,EAAE;IAEL,MAAM,gBAAgB,MAAM,MAAM,CAAC,CAAC;QAClC,MAAM,gBACJ,WAAW,SACV,WAAW,YAAY,KAAK,OAAO,IACnC,WAAW,UAAU,CAAC,KAAK,OAAO;QAErC,MAAM,IAAI,YAAY,WAAW;QACjC,MAAM,gBACJ,KAAK,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,MACjC,KAAK,QAAQ,CAAC,WAAW,GAAG,QAAQ,CAAC;QAEvC,OAAO,iBAAiB;IAC1B;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAAwC;;;;;;8BACtD,8OAAC;oBAAI,WAAU;8BAA4B;;;;;;;;;;;;IAGjD;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAAwC;;;;;;0BAGtD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,gNAAM;wBACL,MAAM;wBACN,WAAU;;;;;;kCAEZ,8OAAC;wBACC,MAAK;wBACL,aAAY;wBACZ,OAAO;wBACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;wBAC9C,WAAU;;;;;;;;;;;;0BAKd,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,SAAS,IAAM,UAAU;wBACzB,WAAW,CAAC,wDAAwD,EAClE,WAAW,QACP,sCACA,uEACJ;kCACH;;;;;;kCAGD,8OAAC;wBACC,SAAS,IAAM,UAAU;wBACzB,WAAW,CAAC,wDAAwD,EAClE,WAAW,WACP,sCACA,uEACJ;kCACH;;;;;;kCAGD,8OAAC;wBACC,SAAS,IAAM,UAAU;wBACzB,WAAW,CAAC,wDAAwD,EAClE,WAAW,SACP,sCACA,uEACJ;kCACH;;;;;;;;;;;;YAMF,cAAc,MAAM,GAAG,kBACtB,8OAAC;gBAAI,WAAU;0BACZ,cAAc,GAAG,CAAC,CAAC,qBAClB,8OAAC,sIAAQ;wBAEP,MAAM;wBACN,SAAS,IAAM,gBAAgB;uBAF1B,KAAK,EAAE;;;;;;;;;qCAOlB,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAE,WAAU;8BAAgB;;;;;;;;;;;YAKhC,8BACC,8OAAC,iJAAe;gBACd,MAAM;gBACN,SAAS,IAAM,gBAAgB;;;;;;;;;;;;AAKzC"}},
    {"offset": {"line": 3486, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/components/tabs/schedule-tab.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useRef } from \"react\"\r\nimport { Upload, Plus, Trash2, Clock, Calendar, User, BookOpen } from \"lucide-react\"\r\nimport { getRooms, getSchedules, createSchedule, deleteSchedule, type Room, type Schedule } from \"@/lib/api\"\r\nimport * as XLSX from 'xlsx'; \r\n\r\n// Helper parse ngày giờ\r\nconst parseExcelDate = (excelValue: any, isTime = false): string => {\r\n  if (!excelValue) return \"\";\r\n  \r\n  if (typeof excelValue === 'number') {\r\n    const date = new Date(Math.round((excelValue - 25569) * 86400 * 1000));\r\n    if (isTime) {\r\n      const h = date.getUTCHours().toString().padStart(2, '0');\r\n      const m = date.getUTCMinutes().toString().padStart(2, '0');\r\n      const s = date.getUTCSeconds().toString().padStart(2, '0');\r\n      return `${h}:${m}:${s}`;\r\n    } else {\r\n      return date.toISOString().split('T')[0];\r\n    }\r\n  }\r\n  \r\n  const str = String(excelValue).trim();\r\n  if (isTime && str.includes(':')) {\r\n      const parts = str.split(':');\r\n      const h = parts[0].padStart(2, '0');\r\n      const m = parts[1] ? parts[1].padStart(2, '0') : '00';\r\n      const s = parts[2] ? parts[2].padStart(2, '0') : '00';\r\n      return `${h}:${m}:${s}`;\r\n  }\r\n  return str;\r\n};\r\n\r\nexport default function ScheduleTab() {\r\n  const [rooms, setRooms] = useState<Room[]>([])\r\n  const [schedules, setSchedules] = useState<Schedule[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [creating, setCreating] = useState(false)\r\n  const [importing, setImporting] = useState(false) \r\n\r\n  // Form state\r\n  const [selectedRoom, setSelectedRoom] = useState<string>(\"\")\r\n  const [courseName, setCourseName] = useState(\"\")\r\n  const [lecturer, setLecturer] = useState(\"\")\r\n  const [selectedDays, setSelectedDays] = useState<string[]>([])\r\n  const [startTime, setStartTime] = useState(\"\")\r\n  const [endTime, setEndTime] = useState(\"\")\r\n  const [effectiveFrom, setEffectiveFrom] = useState(\"\")\r\n  const [effectiveTo, setEffectiveTo] = useState(\"\")\r\n\r\n  const weekdays = [\"MON\", \"TUE\", \"WED\", \"THU\", \"FRI\", \"SAT\", \"SUN\"]\r\n  const fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n  const loadData = async () => {\r\n    // Không set loading=true ở đây để tránh nháy màn hình khi reload ngầm\r\n    try {\r\n      const [r, s] = await Promise.all([getRooms(), getSchedules()])\r\n      setRooms(r)\r\n      setSchedules(s)\r\n    } catch (err) {\r\n      console.error(\"Failed to load schedule data\", err)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadData()\r\n  }, [])\r\n\r\n  function toggleDay(day: string) {\r\n    if (selectedDays.includes(day)) {\r\n        setSelectedDays([])\r\n    } else {\r\n        setSelectedDays([day])\r\n    }\r\n  }\r\n\r\n  async function handleCreateSchedule() {\r\n    if (!selectedRoom || !courseName || !startTime || !endTime || !effectiveFrom || !effectiveTo || selectedDays.length === 0) {\r\n      alert(\"Please fill in all required fields.\")\r\n      return\r\n    }\r\n\r\n    setCreating(true)\r\n    try {\r\n      const formattedStartTime = startTime.length === 5 ? `${startTime}:00` : startTime;\r\n      const formattedEndTime = endTime.length === 5 ? `${endTime}:00` : endTime;\r\n\r\n      // 1. Gọi API tạo lịch\r\n      const newSchedule = await createSchedule(selectedRoom, {\r\n        courseName,\r\n        lecturer,\r\n        weekdays: selectedDays,\r\n        startTime: formattedStartTime,\r\n        endTime: formattedEndTime,\r\n        effectiveFrom,\r\n        effectiveTo\r\n      })\r\n\r\n      // 2. Cập nhật UI NGAY LẬP TỨC bằng cách thêm item mới vào state\r\n      // (Cần bổ sung roomName cho item mới để hiển thị đẹp)\r\n      const roomObj = rooms.find(r => r.id === selectedRoom);\r\n      const scheduleWithRoomName: Schedule = {\r\n        ...newSchedule,\r\n        roomName: roomObj ? (roomObj.name || roomObj.id) : selectedRoom // Fallback name\r\n      };\r\n\r\n      setSchedules(prev => [...prev, scheduleWithRoomName]);\r\n\r\n      // Reset form\r\n      setCourseName(\"\")\r\n      setLecturer(\"\")\r\n      setSelectedDays([])\r\n      setStartTime(\"\")\r\n      setEndTime(\"\")\r\n      setEffectiveFrom(\"\")\r\n      setEffectiveTo(\"\")\r\n      \r\n      // Không cần alert, UI tự cập nhật là đủ feedback rồi\r\n      // alert(\"Schedule created successfully!\") \r\n\r\n    } catch (err) {\r\n      console.error(\"Create error:\", err)\r\n      alert(\"Failed to create schedule.\")\r\n    } finally {\r\n      setCreating(false)\r\n    }\r\n  }\r\n\r\n  async function handleDeleteSchedule(id: string) {\r\n    if (!confirm(\"Are you sure you want to delete this schedule?\")) return\r\n    \r\n    // 1. Optimistic Update: Xóa khỏi UI ngay lập tức\r\n    const previousSchedules = [...schedules];\r\n    setSchedules(prev => prev.filter(s => s.id !== id));\r\n\r\n    try {\r\n      // 2. Gọi API xóa\r\n      await deleteSchedule(id)\r\n    } catch (err) {\r\n      console.error(err)\r\n      alert(\"Failed to delete schedule.\")\r\n      // Nếu lỗi, hoàn tác lại UI\r\n      setSchedules(previousSchedules);\r\n    }\r\n  }\r\n\r\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    setImporting(true);\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = async (evt) => {\r\n      try {\r\n        const bstr = evt.target?.result;\r\n        const wb = XLSX.read(bstr, { type: 'binary' });\r\n        const wsname = wb.SheetNames[0];\r\n        const ws = wb.Sheets[wsname];\r\n        const data = XLSX.utils.sheet_to_json(ws) as any[];\r\n\r\n        let successCount = 0;\r\n        let errorCount = 0;\r\n        \r\n        // Danh sách các lịch mới được tạo thành công để update UI\r\n        const newSchedules: Schedule[] = [];\r\n\r\n        for (const row of data) {\r\n            const roomName = row.Room || row.room;\r\n            const courseName = row.Course || row.course;\r\n            const lecturer = row.Lecturer || row.lecturer;\r\n            const weekdaysRaw = row.Weekdays || row.weekdays;\r\n            const startRaw = row.Start || row.start;\r\n            const endRaw = row.End || row.end;\r\n            const effFromRaw = row.EffectiveFrom || row.effectiveFrom || row.effective_from;\r\n            const effToRaw = row.EffectiveTo || row.effectiveTo || row.effective_to;\r\n\r\n            const room = rooms.find(r => r.name === roomName || r.id === roomName);\r\n            \r\n            if (room && courseName && startRaw && endRaw) {\r\n                try {\r\n                    const sTime = parseExcelDate(startRaw, true);\r\n                    const eTime = parseExcelDate(endRaw, true);\r\n                    \r\n                    let dayToSave = \"\";\r\n                    if (weekdaysRaw) {\r\n                        const parts = String(weekdaysRaw).split(',');\r\n                        if (parts.length > 0) {\r\n                            dayToSave = parts[0].trim().toUpperCase();\r\n                        }\r\n                    }\r\n\r\n                    const validDays = [\"MON\", \"TUE\", \"WED\", \"THU\", \"FRI\", \"SAT\", \"SUN\"];\r\n                    if (!validDays.includes(dayToSave)) {\r\n                        errorCount++;\r\n                        continue;\r\n                    }\r\n\r\n                    const effFrom = parseExcelDate(effFromRaw) || \"2024-01-01\";\r\n                    const effTo = parseExcelDate(effToRaw) || \"2024-12-31\";\r\n\r\n                    // Gọi API\r\n                    const created = await createSchedule(room.id, {\r\n                        courseName: String(courseName),\r\n                        lecturer: String(lecturer || \"\"),\r\n                        weekdays: [dayToSave],\r\n                        startTime: sTime,\r\n                        endTime: eTime,\r\n                        effectiveFrom: effFrom,\r\n                        effectiveTo: effTo\r\n                    });\r\n                    \r\n                    // Thêm vào danh sách tạm để update UI\r\n                    newSchedules.push({\r\n                        ...created,\r\n                        roomName: room.name || room.id\r\n                    });\r\n\r\n                    successCount++;\r\n                } catch (err) {\r\n                    console.error(\"Failed to import row:\", row, err);\r\n                    errorCount++;\r\n                }\r\n            } else {\r\n                errorCount++;\r\n            }\r\n        }\r\n\r\n        // Cập nhật UI ngay lập tức với các lịch vừa import\r\n        setSchedules(prev => [...prev, ...newSchedules]);\r\n\r\n        alert(`Import completed.\\nSuccess: ${successCount}\\nFailed: ${errorCount}`);\r\n\r\n      } catch (error) {\r\n        console.error(\"Error reading file:\", error);\r\n        alert(\"Failed to process Excel file.\");\r\n      } finally {\r\n        setImporting(false);\r\n        if (fileInputRef.current) fileInputRef.current.value = \"\"; \r\n      }\r\n    };\r\n    reader.readAsBinaryString(file);\r\n  };\r\n\r\n  const triggerFileInput = () => {\r\n    fileInputRef.current?.click();\r\n  };\r\n\r\n  if (loading)\r\n    return (\r\n      <div className=\"flex items-center justify-center py-20 text-gray-500 gap-2\">\r\n        <div className=\"w-5 h-5 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin\" />\r\n        Loading schedules...\r\n      </div>\r\n    )\r\n\r\n  return (\r\n    <div className=\"px-4 pt-6 pb-20 space-y-8\">\r\n      \r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-2 flex items-center gap-2\">\r\n          <Calendar className=\"text-emerald-600\" />\r\n          Classroom Schedules\r\n        </h1>\r\n        <p className=\"text-sm text-gray-600\">\r\n          Manage recurring class schedules to automate AC & Lighting controls.\r\n        </p>\r\n      </div>\r\n\r\n      {/* Import Section */}\r\n      <div className=\"glass-panel p-8 text-center border border-gray-100 bg-white rounded-2xl shadow-sm\">\r\n        <div className=\"flex justify-center mb-4\">\r\n          <Upload size={32} className=\"text-emerald-600\" />\r\n        </div>\r\n        <h3 className=\"font-semibold text-gray-900 mb-2\">Import Schedule</h3>\r\n        <p className=\"text-sm text-gray-600 mb-4\">\r\n          Upload Excel file with columns: Room, Course, Lecturer, Weekdays, Start, End, EffectiveFrom, EffectiveTo\r\n        </p>\r\n        \r\n        <input \r\n            type=\"file\" \r\n            accept=\".xlsx, .xls\" \r\n            ref={fileInputRef} \r\n            onChange={handleFileUpload} \r\n            style={{ display: 'none' }} \r\n        />\r\n\r\n        <button \r\n            onClick={triggerFileInput}\r\n            disabled={importing}\r\n            className=\"px-6 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors font-medium text-sm flex items-center gap-2 mx-auto disabled:opacity-50 disabled:cursor-not-allowed\"\r\n        >\r\n          {importing ? (\r\n              <>\r\n                <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                Importing...\r\n              </>\r\n          ) : (\r\n              \"Choose Excel File\"\r\n          )}\r\n        </button>\r\n      </div>\r\n\r\n      {/* Create Form */}\r\n      <div className=\"glass-panel p-6 border border-gray-100 bg-white rounded-2xl shadow-sm\">\r\n        <h3 className=\"font-semibold text-gray-900 mb-5 flex items-center gap-2\">\r\n          <Plus size={20} className=\"text-emerald-600\" />\r\n          Add New Schedule (Manual)\r\n        </h3>\r\n\r\n        <div className=\"space-y-5\">\r\n          {/* Room Selection */}\r\n          <div>\r\n            <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">Room</label>\r\n            <select\r\n              value={selectedRoom}\r\n              onChange={(e) => setSelectedRoom(e.target.value)}\r\n              className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:ring-2 focus:ring-emerald-500 focus:border-transparent outline-none transition-all\"\r\n            >\r\n              <option value=\"\">Select a Room...</option>\r\n              {rooms.map((room) => (\r\n                <option key={room.id} value={room.id}>\r\n                  {room.name} ({room.building} - {room.floor})\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n\r\n          {/* Course & Lecturer */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">Course Name</label>\r\n              <div className=\"relative\">\r\n                <BookOpen size={18} className=\"absolute left-3 top-3 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={courseName}\r\n                  onChange={(e) => setCourseName(e.target.value)}\r\n                  placeholder=\"e.g. Advanced IoT\"\r\n                  className=\"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition-all\"\r\n                />\r\n              </div>\r\n            </div>\r\n            <div>\r\n              <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">Lecturer</label>\r\n              <div className=\"relative\">\r\n                <User size={18} className=\"absolute left-3 top-3 text-gray-400\" />\r\n                <input\r\n                  type=\"text\"\r\n                  value={lecturer}\r\n                  onChange={(e) => setLecturer(e.target.value)}\r\n                  placeholder=\"e.g. Dr. Smith\"\r\n                  className=\"w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-emerald-500 outline-none transition-all\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* NEW: Effective Dates */}\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">Effective From</label>\r\n              <input\r\n                type=\"date\"\r\n                value={effectiveFrom}\r\n                onChange={(e) => setEffectiveFrom(e.target.value)}\r\n                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">Effective To</label>\r\n              <input\r\n                type=\"date\"\r\n                value={effectiveTo}\r\n                onChange={(e) => setEffectiveTo(e.target.value)}\r\n                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Weekdays */}\r\n          <div>\r\n            <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block\">Days of Week</label>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {weekdays.map((day) => (\r\n                <button\r\n                  key={day}\r\n                  onClick={() => toggleDay(day)}\r\n                  className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${\r\n                    selectedDays.includes(day)\r\n                      ? \"bg-emerald-600 text-white shadow-md shadow-emerald-200 scale-105\"\r\n                      : \"bg-gray-100 text-gray-500 hover:bg-gray-200\"\r\n                  }`}\r\n                >\r\n                  {day}\r\n                </button>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Time Range */}\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div>\r\n              <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">Start Time</label>\r\n              <input\r\n                type=\"time\"\r\n                value={startTime}\r\n                onChange={(e) => setStartTime(e.target.value)}\r\n                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block\">End Time</label>\r\n              <input\r\n                type=\"time\"\r\n                value={endTime}\r\n                onChange={(e) => setEndTime(e.target.value)}\r\n                className=\"w-full px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-xl text-gray-900 focus:ring-2 focus:ring-emerald-500 outline-none\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            onClick={handleCreateSchedule}\r\n            disabled={creating}\r\n            className=\"w-full py-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 transition-all font-bold shadow-lg shadow-emerald-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\r\n          >\r\n            {creating ? (\r\n              <>\r\n                <div className=\"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                Saving...\r\n              </>\r\n            ) : (\r\n              \"Save Schedule\"\r\n            )}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Schedule List */}\r\n      <div className=\"mb-8\">\r\n        <h3 className=\"font-semibold text-gray-900 mb-4\">All Schedules</h3>\r\n        <div className=\"space-y-3\">\r\n          {schedules.length === 0 ? (\r\n             <div className=\"text-center py-8 text-gray-400 text-sm border border-dashed border-gray-200 rounded-xl bg-gray-50\">No schedules found</div>\r\n          ) : (\r\n             schedules.map((schedule) => (\r\n            <div key={schedule.id} className=\"glass-panel p-5 border-l-4 border-l-emerald-500 bg-white rounded-xl shadow-sm\">\r\n              <div className=\"flex items-start justify-between mb-3\">\r\n                <div>\r\n                  <p className=\"text-xs font-medium text-gray-600 uppercase\">{schedule.roomName}</p>\r\n                  <h4 className=\"font-semibold text-gray-900 mt-1\">{schedule.courseName}</h4>\r\n                  <p className=\"text-sm text-gray-600\">{schedule.lecturer}</p>\r\n                </div>\r\n                <button \r\n                  onClick={() => handleDeleteSchedule(schedule.id)}\r\n                  className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\r\n                  title=\"Delete Schedule\"\r\n                >\r\n                  <Trash2 size={18} className=\"text-gray-400 hover:text-red-600\" />\r\n                </button>\r\n              </div>\r\n              \r\n              <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\r\n                {/* Fix lỗi toString() trên type never bằng String() */}\r\n                {(Array.isArray(schedule.weekdays) \r\n                    ? schedule.weekdays \r\n                    : String(schedule.weekdays || \"\").split(',')\r\n                 ).map((day) => (\r\n                  <span\r\n                    key={day}\r\n                    className=\"px-2 py-1 bg-emerald-50 text-emerald-700 text-xs font-medium rounded\"\r\n                  >\r\n                    {day.trim().slice(0, 3)}\r\n                  </span>\r\n                ))}\r\n              </div>\r\n              \r\n              <div className=\"flex justify-between items-end pt-2 border-t border-gray-50 mt-2\">\r\n                  <p className=\"text-sm text-gray-600 flex items-center gap-1\">\r\n                    <Clock size={14} className=\"text-emerald-600\"/> \r\n                    {schedule.startTime ? schedule.startTime.substring(0, 5) : \"--:--\"} – {schedule.endTime ? schedule.endTime.substring(0, 5) : \"--:--\"}\r\n                  </p>\r\n                  {schedule.effectiveFrom && (\r\n                      <p className=\"text-[10px] text-gray-400\">\r\n                          {schedule.effectiveFrom} → {schedule.effectiveTo}\r\n                      </p>\r\n                  )}\r\n              </div>\r\n            </div>\r\n          )))}\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4396, "column": 0}, "map": {"version":3,"sources":["file:///D:/quinnhu/hk7/ITProject/GreenTwinUpdater/GreenTwinAppUI/app/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport HomeTab from \"@/components/tabs/home-tab\"\r\nimport RoomsTab from \"@/components/tabs/rooms-tab\"\r\nimport ScheduleTab from \"@/components/tabs/schedule-tab\"\r\nimport { Home, Building2, Calendar } from \"lucide-react\"\r\n\r\nexport default function GreenTwinApp() {\r\n  const [activeTab, setActiveTab] = useState<\"home\" | \"rooms\" | \"schedule\">(\"home\")\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-gray-50 flex flex-col\">\r\n      <div className=\"flex-1 overflow-y-auto pb-20\">\r\n        {activeTab === \"home\" && <HomeTab />}\r\n        {activeTab === \"rooms\" && <RoomsTab />}\r\n        {activeTab === \"schedule\" && <ScheduleTab />}\r\n      </div>\r\n\r\n      <nav className=\"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-gray-200 shadow-lg\">\r\n        <div className=\"flex justify-around items-center py-2\">\r\n          <button\r\n            onClick={() => setActiveTab(\"home\")}\r\n            className={`flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition-all ${\r\n              activeTab === \"home\" ? \"text-green-600 bg-green-50\" : \"text-gray-600 hover:text-gray-900\"\r\n            }`}\r\n          >\r\n            <Home size={24} strokeWidth={activeTab === \"home\" ? 2.5 : 2} />\r\n            <span className=\"text-xs font-medium\">Home</span>\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab(\"rooms\")}\r\n            className={`flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition-all ${\r\n              activeTab === \"rooms\" ? \"text-green-600 bg-green-50\" : \"text-gray-600 hover:text-gray-900\"\r\n            }`}\r\n          >\r\n            <Building2 size={24} strokeWidth={activeTab === \"rooms\" ? 2.5 : 2} />\r\n            <span className=\"text-xs font-medium\">Rooms</span>\r\n          </button>\r\n          <button\r\n            onClick={() => setActiveTab(\"schedule\")}\r\n            className={`flex flex-col items-center gap-1 px-6 py-2 rounded-xl transition-all ${\r\n              activeTab === \"schedule\" ? \"text-green-600 bg-green-50\" : \"text-gray-600 hover:text-gray-900\"\r\n            }`}\r\n          >\r\n            <Calendar size={24} strokeWidth={activeTab === \"schedule\" ? 2.5 : 2} />\r\n            <span className=\"text-xs font-medium\">Schedule</span>\r\n          </button>\r\n        </div>\r\n      </nav>\r\n    </main>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AAAA;AANA;;;;;;;AAQe,SAAS;IACtB,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAgC;IAE1E,qBACE,8OAAC;QAAK,WAAU;;0BACd,8OAAC;gBAAI,WAAU;;oBACZ,cAAc,wBAAU,8OAAC,6IAAO;;;;;oBAChC,cAAc,yBAAW,8OAAC,8IAAQ;;;;;oBAClC,cAAc,4BAAc,8OAAC,iJAAW;;;;;;;;;;;0BAG3C,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,SAAS,IAAM,aAAa;4BAC5B,WAAW,CAAC,qEAAqE,EAC/E,cAAc,SAAS,+BAA+B,qCACtD;;8CAEF,8OAAC,2MAAI;oCAAC,MAAM;oCAAI,aAAa,cAAc,SAAS,MAAM;;;;;;8CAC1D,8OAAC;oCAAK,WAAU;8CAAsB;;;;;;;;;;;;sCAExC,8OAAC;4BACC,SAAS,IAAM,aAAa;4BAC5B,WAAW,CAAC,qEAAqE,EAC/E,cAAc,UAAU,+BAA+B,qCACvD;;8CAEF,8OAAC,6NAAS;oCAAC,MAAM;oCAAI,aAAa,cAAc,UAAU,MAAM;;;;;;8CAChE,8OAAC;oCAAK,WAAU;8CAAsB;;;;;;;;;;;;sCAExC,8OAAC;4BACC,SAAS,IAAM,aAAa;4BAC5B,WAAW,CAAC,qEAAqE,EAC/E,cAAc,aAAa,+BAA+B,qCAC1D;;8CAEF,8OAAC,sNAAQ;oCAAC,MAAM;oCAAI,aAAa,cAAc,aAAa,MAAM;;;;;;8CAClE,8OAAC;oCAAK,WAAU;8CAAsB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMlD"}}]
}